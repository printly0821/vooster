#!/bin/bash

# ============================================================================
# Tailwind CSS Fix Commit Script
# ============================================================================
# ëª©ì : Tailwind CSS v3 ë‹¤ìš´ê·¸ë ˆì´ë“œ ê´€ë ¨ ì»¤ë°‹
# ì‚¬ìš©ë²•: bash scripts/commit-tailwind-fix.sh
# ============================================================================

set -e

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# í•¨ìˆ˜ ì •ì˜
print_header() {
  echo ""
  echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
  echo -e "${BLUE}$1${NC}"
  echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
  echo ""
}

print_success() {
  echo -e "${GREEN}âœ“ $1${NC}"
}

print_warning() {
  echo -e "${YELLOW}âš  $1${NC}"
}

print_error() {
  echo -e "${RED}âœ— $1${NC}"
}

print_info() {
  echo -e "${BLUE}â„¹ $1${NC}"
}

# ============================================================================
# ì‚¬ì „ í™•ì¸
# ============================================================================

print_header "ì‚¬ì „ í™•ì¸ ë‹¨ê³„"

# Git ì €ì¥ì†Œ í™•ì¸
if [ ! -d ".git" ]; then
  print_error "Git ì €ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”."
  exit 1
fi

print_success "Git ì €ì¥ì†Œ í™•ì¸ ì™„ë£Œ"

# ============================================================================
# íŒŒì¼ ëª©ë¡ í™•ì¸
# ============================================================================

print_header "ì»¤ë°‹í•  íŒŒì¼ ëª©ë¡"

FILES_TO_COMMIT=(
  "package.json"
  "package-lock.json"
  "postcss.config.mjs"
  "src/app/globals.css"
  "tailwind.config.ts"
)

print_info "ë‹¤ìŒ íŒŒì¼ë“¤ì´ ì»¤ë°‹ë©ë‹ˆë‹¤:"
for file in "${FILES_TO_COMMIT[@]}"; do
  if [ -f "$file" ]; then
    print_success "$file"
  else
    print_warning "$file (ì¡´ì¬í•˜ì§€ ì•ŠìŒ)"
  fi
done

echo ""

# ============================================================================
# Git ìƒíƒœ í™•ì¸
# ============================================================================

print_header "Git ìƒíƒœ í™•ì¸"

echo "í˜„ì¬ ë³€ê²½ì‚¬í•­:"
git status --short

echo ""
echo -e "${YELLOW}ë³€ê²½ì‚¬í•­ì„ ìŠ¤í…Œì´ì§•í•˜ê³  ì»¤ë°‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)${NC}"
read -r response

if [ "$response" != "y" ] && [ "$response" != "Y" ]; then
  print_error "ì»¤ë°‹ ì·¨ì†Œë¨"
  exit 1
fi

# ============================================================================
# Git ìŠ¤í…Œì´ì§•
# ============================================================================

print_header "Git ìŠ¤í…Œì´ì§•"

# ë³€ê²½ëœ íŒŒì¼ë“¤ì„ ìŠ¤í…Œì´ì§•
for file in "${FILES_TO_COMMIT[@]}"; do
  if [ -f "$file" ]; then
    git add "$file" 2>/dev/null || true
  fi
done

print_success "íŒŒì¼ ìŠ¤í…Œì´ì§• ì™„ë£Œ"

# ============================================================================
# ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„± ë° ì»¤ë°‹
# ============================================================================

print_header "ì»¤ë°‹ ìƒì„±"

git commit -m "$(cat <<'EOF'
fix: Tailwind CSS v3ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œí•˜ì—¬ Vercel ë¹Œë“œ ì˜¤ë¥˜ í•´ê²°

- Tailwind CSS v4 â†’ v3.4.1 ë‹¤ìš´ê·¸ë ˆì´ë“œ
- globals.css v3 ë¬¸ë²•ìœ¼ë¡œ ì—…ë°ì´íŠ¸
- PostCSS í‘œì¤€ ì„¤ì • ì ìš©
- tailwind.config.ts ìƒì„±
- autoprefixer ì¶”ê°€

Vercel ë°°í¬ ì‹œ CSSê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•Šë˜ ë¬¸ì œ í•´ê²°

ğŸ¤– Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"

COMMIT_RESULT=$?

if [ $COMMIT_RESULT -eq 0 ]; then
  print_success "ì»¤ë°‹ ì™„ë£Œ!"

  # ì»¤ë°‹ ì •ë³´ ì¶œë ¥
  echo ""
  print_header "ì»¤ë°‹ ì •ë³´"
  git log -1 --oneline

  echo ""
  print_header "ë‹¤ìŒ ë‹¨ê³„"
  print_info "í‘¸ì‹œí•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:"
  echo -e "   ${BLUE}git push origin master${NC}"
  echo ""

else
  print_error "ì»¤ë°‹ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"
  exit 1
fi

print_success "ì™„ë£Œ!"
echo ""
