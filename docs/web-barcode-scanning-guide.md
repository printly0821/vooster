---
title: "ì›¹ ê¸°ë°˜ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œìŠ¤í…œ ê°œë°œ ê°€ì´ë“œ"
description: "ì‚°ì—…í˜„ì¥ì—ì„œ ì‹¤ì œë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œìŠ¤í…œì„ ë§Œë“¤ê¸°ê¹Œì§€ì˜ ì—¬ì •ê³¼ êµí›ˆ"
category: "guide"
author: "ì‹ ìš°ì§„"
date: "2025-10-18"
public: true
order: 1
---

# ì›¹ ê¸°ë°˜ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œìŠ¤í…œ ê°œë°œ ê°€ì´ë“œ

> ì‚°ì—…í˜„ì¥ì—ì„œ ì‹¤ì œë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œìŠ¤í…œì„ ë§Œë“¤ê¸°ê¹Œì§€ì˜ ì—¬ì •ê³¼ êµí›ˆ

**ì‘ì„±ì¼**: 2025-10-18
**í”„ë¡œì íŠ¸**: Vooster ì œì‘ì˜ë¢°ì„œ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œìŠ¤í…œ
**ê¸°ê°„**: Phase 1-11 (ì•½ 10ì‹œê°„)

---

## ğŸ“š ëª©ì°¨

### ê¸°ë³¸í¸ (Phase 1-11: ë°”ì½”ë“œ ìŠ¤ìº” ìµœì í™”)
1. [ì™œ ì›¹ì—ì„œ ë°”ì½”ë“œ ìŠ¤ìº”ì´ ì–´ë ¤ìš´ê°€?](#1-ì™œ-ì›¹ì—ì„œ-ë°”ì½”ë“œ-ìŠ¤ìº”ì´-ì–´ë ¤ìš´ê°€)
2. [í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ê³¼ ì‚°ì—…í˜„ì¥ íŠ¹ì„±](#2-í”„ë¡œì íŠ¸-ìš”êµ¬ì‚¬í•­ê³¼-ì‚°ì—…í˜„ì¥-íŠ¹ì„±)
3. [ê²ªì—ˆë˜ ë¬¸ì œë“¤ê³¼ í•´ê²° ê³¼ì •](#3-ê²ªì—ˆë˜-ë¬¸ì œë“¤ê³¼-í•´ê²°-ê³¼ì •)
4. [ìµœì¢… êµ¬í˜„ ê²°ê³¼](#4-ìµœì¢…-êµ¬í˜„-ê²°ê³¼)
5. [í•µì‹¬ êµí›ˆê³¼ Best Practices](#5-í•µì‹¬-êµí›ˆê³¼-best-practices)
6. [í–¥í›„ ìœ ì‚¬ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ ê°€ì´ë“œ](#6-í–¥í›„-ìœ ì‚¬-í”„ë¡œì íŠ¸ë¥¼-ìœ„í•œ-ê°€ì´ë“œ)

### ê³ ê¸‰í¸ (T-004~T-010: ì‹¤ì‹œê°„ í†µì‹  ë° ë™ê¸°í™”)
13. [ì‹¤ì‹œê°„ í†µì‹  ì•„í‚¤í…ì²˜ (Socket.IO ê¸°ë°˜)](#13-ì‹¤ì‹œê°„-í†µì‹ -ì•„í‚¤í…ì²˜-socketio-ê¸°ë°˜)
14. [ì„¸ì…˜ í˜ì–´ë§ ì‹œìŠ¤í…œ (QR ì½”ë“œ ê¸°ë°˜)](#14-ì„¸ì…˜-í˜ì–´ë§-ì‹œìŠ¤í…œ-qr-ì½”ë“œ-ê¸°ë°˜)
15. [ë™ê¸°í™” ì—”ì§„ ì•„í‚¤í…ì²˜](#15-ë™ê¸°í™”-ì—”ì§„-ì•„í‚¤í…ì²˜)

### ê´€ë ¨ ë¬¸ì„œ
- ğŸ“± [React ê³ ê¸‰ íŒ¨í„´ ê°€ì´ë“œ](./react-advanced-guide.md) - ë©€í‹° ë””ìŠ¤í”Œë ˆì´, Socket.IO hooks, ì„±ëŠ¥ ìµœì í™”
- ğŸš€ [í”„ë¡œë•ì…˜ ë°°í¬ ê°€ì´ë“œ](../vooster-docs/production-deployment.md) - PM2, Docker, Nginx, CI/CD
- ğŸ”· [TypeScript íƒ€ì… ì‹œìŠ¤í…œ ê°€ì´ë“œ](../vooster-docs/features/typescript-type-system-guide.md) - Zod, Generic, íƒ€ì… ê°€ë“œ

---

## 1. ì™œ ì›¹ì—ì„œ ë°”ì½”ë“œ ìŠ¤ìº”ì´ ì–´ë ¤ìš´ê°€?

### 1.1 ëª¨ë°”ì¼ ì•±ê³¼ì˜ ì°¨ì´

**ëª¨ë°”ì¼ ë„¤ì´í‹°ë¸Œ ì•±** (Android/iOS):
```
âœ… ì¹´ë©”ë¼ API ì§ì ‘ ì ‘ê·¼
âœ… í•˜ë“œì›¨ì–´ ê°€ì† (GPU)
âœ… ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬
âœ… ìµœì í™”ëœ ë°”ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬
â†’ ê²°ê³¼: ì¦‰ì‹œ ì¸ì‹ (0.1-0.3ì´ˆ)
```

**ì›¹ ë¸Œë¼ìš°ì €**:
```
âš ï¸ ì œí•œëœ Camera API (getUserMedia)
âš ï¸ JavaScript ì‹±ê¸€ ìŠ¤ë ˆë“œ (ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹)
âš ï¸ ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¤ë¥¸ ë™ì‘
âš ï¸ ì„±ëŠ¥ ì œì•½ (ë°°í„°ë¦¬, ë©”ëª¨ë¦¬)
â†’ ê²°ê³¼: ëŠë¦° ì¸ì‹ (ì´ˆê¸° 5-10ì´ˆ)
```

### 1.2 ì›¹ í™˜ê²½ì˜ ê¸°ìˆ ì  ì œì•½

#### A. ì¹´ë©”ë¼ ì ‘ê·¼ ë³µì¡ë„
1. **ë³´ì•ˆ ìš”êµ¬ì‚¬í•­**: HTTPS ë˜ëŠ” localhostì—ì„œë§Œ ì‘ë™
2. **ê¶Œí•œ ìš”ì²­**: ì‚¬ìš©ìê°€ ë§¤ë²ˆ í—ˆìš©í•´ì•¼ í•¨ (iOS SafariëŠ” ë” ê¹Œë‹¤ë¡œì›€)
3. **ë¸Œë¼ìš°ì € í˜¸í™˜ì„±**:
   - Chrome/Edge: ë¹„êµì  ì•ˆì •ì 
   - Safari: íŠ¹ë³„ ì²˜ë¦¬ í•„ìš”
   - Firefox: ì¼ë¶€ API ë¯¸ì§€ì›

#### B. ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì´ˆê¸°í™”
```
getUserMedia() í˜¸ì¶œ
â†’ ì¹´ë©”ë¼ ë“œë¼ì´ë²„ ì´ˆê¸°í™” (1-3ì´ˆ)
â†’ video ìš”ì†Œ ì¤€ë¹„ (readyState ì²´í¬)
â†’ video.play() ì„±ê³µ
â†’ ì‹¤ì œ í”„ë ˆì„ ë°ì´í„° ì¤€ë¹„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ 2-5ì´ˆ ì†Œìš” (í”¼í•  ìˆ˜ ì—†ìŒ)
```

#### C. ë°”ì½”ë“œ ë””ì½”ë”© ì„±ëŠ¥
- **JavaScriptë¡œ ì´ë¯¸ì§€ ì²˜ë¦¬**: ë„¤ì´í‹°ë¸Œë³´ë‹¤ 10-100ë°° ëŠë¦¼
- **ë§¤ í”„ë ˆì„ë§ˆë‹¤ ë””ì½”ë”©**: CPU ì§‘ì•½ì  ì‘ì—…
- **ë°°í„°ë¦¬/ë°œì—´ ë¬¸ì œ**: ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ì—ì„œ ì‹¬ê°

---

## 2. í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ê³¼ ì‚°ì—…í˜„ì¥ íŠ¹ì„±

### 2.1 ì‚°ì—…í˜„ì¥ ì›Œí¬í”Œë¡œìš°

```
[ì‘ì—…ì] ì œí’ˆì— ë¶€ì°©ëœ ë°”ì½”ë“œ ìŠ¤ìº”
   â†“ (ì¦‰ì‹œ ì¸ì‹ í•„ìš”)
[ì‹œìŠ¤í…œ] ì œì‘ì˜ë¢°ì„œ í˜ì´ì§€ í‘œì‹œ
   â†“
[ì‘ì—…ì] ì´ë¯¸ì§€ í™•ì¸ (ì œí’ˆ ì‚¬ì§„, ìˆ˜ëŸ‰ ë“±)
   â†“
[ì‘ì—…ì] "ë‹¤ì‹œ ìŠ¤ìº”" ë²„íŠ¼ í´ë¦­
   â†“
[ì‹œìŠ¤í…œ] ìŠ¤ìº” í˜ì´ì§€ë¡œ ë³µê·€
   â†“ (ì¦‰ì‹œ ì¬ìŠ¤ìº” ê°€ëŠ¥í•´ì•¼ í•¨!)
[ì‘ì—…ì] ë‹¤ìŒ ì œí’ˆ ë°”ì½”ë“œ ìŠ¤ìº”
   â†“
ë°˜ë³µ (í•˜ë£¨ 100ê°œ ì´ìƒ)
```

### 2.2 í•µì‹¬ ìš”êµ¬ì‚¬í•­

#### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
- âœ… QR ì½”ë“œ + 1D ë°”ì½”ë“œ (CODE_128, CODE_39, EAN_13) ì§€ì›
- âœ… ì£¼ë¬¸ë²ˆí˜¸ í˜•ì‹ ê²€ì¦ (ì •ê·œì‹)
- âœ… ë¬´íš¨í•œ ë°”ì½”ë“œ ìë™ ë¬´ì‹œ
- âœ… ì§„ë™ í”¼ë“œë°± (ì„±ê³µ/ì‹¤íŒ¨)

#### ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­
- âš¡ ì²« ìŠ¤ìº”: **1ì´ˆ ì´ë‚´**
- âš¡ ì—°ì† ìŠ¤ìº”: **0.5ì´ˆ ì´ë‚´** (í•µì‹¬!)
- ğŸ”‹ ë°°í„°ë¦¬ íš¨ìœ¨ì 
- ğŸŒ¡ï¸ ë””ë°”ì´ìŠ¤ ë°œì—´ ìµœì†Œí™”

#### ì‚¬ìš©ì„± ìš”êµ¬ì‚¬í•­
- ğŸ¯ ì§ê´€ì ì¸ UI (ì‘ì—…ì êµìœ¡ ìµœì†Œí™”)
- ğŸ”„ ë¹ ë¥¸ ì—°ì† ì‘ì—… (ì‘ì—… íë¦„ ë‹¨ì ˆ ì—†ìŒ)
- ğŸ“± ëª¨ë°”ì¼ ìµœì í™” (í˜„ì¥ì—ì„œ ìŠ¤ë§ˆíŠ¸í°/íƒœë¸”ë¦¿ ì‚¬ìš©)

---

## 3. ê²ªì—ˆë˜ ë¬¸ì œë“¤ê³¼ í•´ê²° ê³¼ì •

### 3.1 Phase 1-2: ì´ˆê¸° ì„±ëŠ¥ ë¬¸ì œ

#### ë¬¸ì œ
```
ë°”ì½”ë“œ ìŠ¤ìº” ì‹œì‘ê¹Œì§€ 5-20ì´ˆ ì†Œìš”
â†’ ì‚°ì—…í˜„ì¥ì—ì„œ ì‹¤ìš© ë¶ˆê°€ëŠ¥
```

#### ì›ì¸ ë¶„ì„
1. **ë¹„ë””ì˜¤ ì¤€ë¹„ ê²€ì¦ ì‹œê°„**: 15ì´ˆ íƒ€ì„ì•„ì›ƒ
2. **ZXing ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ˆê¸°í™”**: ë§¤ë²ˆ 200-500ms
3. **ê³ í•´ìƒë„ ì²˜ë¦¬**: 1920x1080 í”½ì…€
4. **ê¶Œí•œ ìš”ì²­ ëŒ€ê¸°**: ì‚¬ìš©ì ìˆ˜ë™ í´ë¦­

#### í•´ê²° ë°©ë²•
```typescript
// 1. íƒ€ì„ì•„ì›ƒ ë‹¨ì¶•: 15ì´ˆ â†’ 5ì´ˆ
const timeout = 5000;

// 2. ZXing ì‚¬ì „ ì´ˆê¸°í™” (Provider mount ì‹œ)
const [zxingReader] = useState(() => initializeGlobalZXingReader());

// 3. í•´ìƒë„ ìµœì í™”: 1920x1080 â†’ 1280x720
width: { ideal: 1280 }
height: { ideal: 720 }

// 4. ìë™ ê¶Œí•œ ìš”ì²­
<CameraProvider options={{ autoRequest: true }}>
```

**ê²°ê³¼**: 5-20ì´ˆ â†’ **2-3ì´ˆ** (60-70% ê°œì„ )

---

### 3.2 Phase 3: ë°˜ë³µ ìŠ¤ìº” ì‹œ ì†ë„ ì €í•˜

#### ë¬¸ì œ
```
1ì°¨ ìŠ¤ìº”: ë¹ ë¦„ (2-3ì´ˆ)
2ì°¨ ìŠ¤ìº”: ëŠë¦¼ (5ì´ˆ)
3ì°¨ ìŠ¤ìº”: ë§¤ìš° ëŠë¦¼ (10ì´ˆ+)
â†’ ì‚¬ìš©í• ìˆ˜ë¡ ëŠë ¤ì§
```

#### ì›ì¸ ë¶„ì„
1. **videoReadyRef ìºì‹œ ì˜¤ì‘ë™**: í•œ ë²ˆ trueê°€ ë˜ë©´ ë¦¬ì…‹ ì•ˆ ë¨
2. **setTimeout cleanup ëˆ„ë½**: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
3. **Video stream íŠ¸ë™ ë¯¸ì •ë¦¬**: ì´ì „ ìŠ¤íŠ¸ë¦¼ ëˆ„ì 
4. **ZXing reader ë¦¬ì†ŒìŠ¤ ëˆ„ì **

#### í•´ê²° ë°©ë²•
```typescript
// 1. videoReadyRef ë¦¬ì…‹ ì¶”ê°€
const stopScanning = () => {
  // ...
  videoReadyRef.current = false; // ë¦¬ì…‹
};

// 2. setTimeout ì¶”ì  ë° ì •ë¦¬
const pendingTimers = useRef([]);
const timer = setTimeout(...);
pendingTimers.current.push(timer);
// cleanup:
pendingTimers.current.forEach(t => clearTimeout(t));

// 3. Video stream ëª…ì‹œì  ì •ë¦¬
if (currentStream) {
  currentStream.getTracks().forEach(t => t.stop());
}
video.srcObject = null;

// 4. ZXing reader cleanup
useEffect(() => {
  return () => {
    if (globalZXingReader) globalZXingReader = null;
  };
}, []);
```

**ê²°ê³¼**: ëª¨ë“  ìŠ¤ìº”ì´ ì¼ì •í•œ ì†ë„ ìœ ì§€ âœ…

---

### 3.3 Phase 4-10: ë¹„ë””ì˜¤ ì¤€ë¹„ íƒ€ì„ì•„ì›ƒ (ê°€ì¥ ì–´ë ¤ì› ë˜ ë¬¸ì œ)

#### ë¬¸ì œ (9ë²ˆì˜ ì‹œë„!)
```
âŒ Video element failed to become ready within 10000ms

ì‹¬ì§€ì–´:
readyState: 4 (HAVE_ENOUGH_DATA) âœ…
videoWidth: 1280 âœ…
videoHeight: 720 âœ…
â†’ ê·¸ëŸ°ë°ë„ íƒ€ì„ì•„ì›ƒ!
```

#### ì˜ëª»ëœ ì ‘ê·¼ë“¤ (Phase 4-9)

**Phase 4**: íƒ€ì„ì•„ì›ƒ ì¡°ì • (5ì´ˆ â†’ 10ì´ˆ)
- âŒ ì‹¤íŒ¨: 10ì´ˆë„ ë¶€ì¡±

**Phase 5**: play() ì¬ì‹œë„ ê°•í™” (3íšŒ â†’ 5íšŒ)
- âŒ ì‹¤íŒ¨: playëŠ” ì„±ê³µí•˜ëŠ”ë° íƒ€ì„ì•„ì›ƒ

**Phase 6**: stream track ê²€ì¦ ì¶”ê°€
- âŒ ì‹¤íŒ¨: trackì€ ì •ìƒì¸ë° íƒ€ì„ì•„ì›ƒ

**Phase 7**: useEffect dependency ì•ˆì •í™” (ref íŒ¨í„´)
- âŒ ì‹¤íŒ¨: cleanup/remount ì—¬ì „íˆ ë°œìƒ

**Phase 8**: React.memo + useMemo
- âŒ ì‹¤íŒ¨: ë¦¬ë Œë”ë§ ì¤„ì—ˆì§€ë§Œ íƒ€ì„ì•„ì›ƒ

**Phase 9**: AnimatePresence ì œê±°
- âš ï¸ ë¶€ë¶„ ì„±ê³µ: unmount ë°©ì§€, í•˜ì§€ë§Œ íƒ€ì„ì•„ì›ƒ ê³„ì†

**ê³µí†µì **: ëª¨ë‘ **ì¦ìƒë§Œ ì¹˜ë£Œ**, ì§„ì§œ ì›ì¸ì„ ëª» ì°¾ìŒ

#### ì§„ì§œ ì›ì¸ ë°œê²¬ (Phase 10)

**3ê°œ ì „ë¬¸ ì—ì´ì „íŠ¸ ë™ì›** í›„ ë¡œê·¸ ì¬ë¶„ì„:

```javascript
ğŸ“Š Video ìƒíƒœ: {
  readyState: 4,
  networkState: 2,  // â† ì´ê²Œ ì›ì¸!
}

// networkState ê°’ì˜ ì˜ë¯¸:
NETWORK_EMPTY = 0
NETWORK_IDLE = 1
NETWORK_LOADING = 2  â† ë¡œê·¸ì˜ ê°’
NETWORK_NO_SOURCE = 3
```

**isVideoReady() í•¨ìˆ˜**:
```typescript
const isNetworkStable =
  video.networkState !== video.NETWORK_LOADING  // â† FALSE!

return hasMetadata && isNetworkStable;  // â†’ FALSE
```

**ë¬¸ì œì **:
- MediaStream (ì‹¤ì‹œê°„ ì¹´ë©”ë¼)ì€ **ëì´ ì—†ëŠ” ìŠ¤íŠ¸ë¦¼**
- ë¸Œë¼ìš°ì €ê°€ ì´ë¥¼ "ê³„ì† ë¡œë”© ì¤‘"ìœ¼ë¡œ ì·¨ê¸‰
- **networkState = NETWORK_LOADING (2)ì€ ì •ìƒ ìƒíƒœ**
- í•˜ì§€ë§Œ ì½”ë“œëŠ” ì´ë¥¼ "ì¤€ë¹„ ì•ˆ ë¨"ìœ¼ë¡œ íŒë‹¨

#### í•´ê²° ë°©ë²• (1ì¤„ ìˆ˜ì •!)
```typescript
// BEFORE: networkState ì²´í¬ í¬í•¨
const isVideoReady = () => {
  return hasMetadata && isNetworkStable;  // networkState ì²´í¬
};

// AFTER: networkState ì²´í¬ ì œê±°
const isVideoReady = () => {
  return (
    video.readyState >= video.HAVE_METADATA &&
    video.videoWidth > 0 &&
    video.videoHeight > 0
    // networkState ì²´í¬ ì œê±° âœ…
  );
};
```

**ê²°ê³¼**: íƒ€ì„ì•„ì›ƒ **ì™„ì „ í•´ê²°** (100%)

**êµí›ˆ**:
- ë¡œê·¸ì˜ ìˆ«ì ê°’ì„ ì •í™•íˆ í™•ì¸í•´ì•¼ í•¨
- ê°€ì • ëŒ€ì‹  ì¦ê±° ê¸°ë°˜ ë””ë²„ê¹…
- ì „ë¬¸ê°€ ì˜ê²¬ í™œìš© (ì—ì´ì „íŠ¸ ë™ì›)

---

### 3.4 Phase 11: ì‚°ì—…í˜„ì¥ ì„±ëŠ¥ ìµœì í™”

#### ë¬¸ì œ
```
íƒ€ì„ì•„ì›ƒì€ í•´ê²°ë˜ì—ˆì§€ë§Œ:
- ì²« ìŠ¤ìº”: ì—¬ì „íˆ ëŠë¦¼ (3-5ì´ˆ)
- ì—°ì† ìŠ¤ìº”: ì ì  ëŠë ¤ì§
- ì‘ì—…ì: "ì“¸ ìˆ˜ê°€ ì—†ë‹¤"
```

#### 3ê°œ ì—ì´ì „íŠ¸ ë¶„ì„ ê²°ê³¼

**TypeScript-Pro**:
- TRY_HARDER íŒíŠ¸ê°€ ë””ì½”ë”© 50-60% ëŠë¦¬ê²Œ í•¨
- í¬ë§· ì œí•œ ê¶Œì¥

**React-Specialist**:
- 60fps ë””ì½”ë”©ì´ CPU ê³¼ë¶€í•˜ ìœ ë°œ
- í”„ë ˆì„ ìŠ¤í‚µ ê¶Œì¥ (15fpsë©´ ì¶©ë¶„)

**Next.js-Developer**:
- videoReadyRef ë¦¬ì…‹ì´ ì—°ì† ìŠ¤ìº” ëŠë¦¬ê²Œ í•¨
- ìºì‹œ ìœ ì§€ ê¶Œì¥

#### í•´ê²° ë°©ë²•

**1. TRY_HARDER ì œê±° + í¬ë§· ì œí•œ**
```typescript
// BEFORE: ëª¨ë“  í¬ë§· + ë†’ì€ ì •í™•ë„ (ëŠë¦¼)
hints.set(DecodeHintType.TRY_HARDER, true);

// AFTER: ì£¼ë¬¸ë²ˆí˜¸ í¬ë§·ë§Œ (ë¹ ë¦„)
hints.set(DecodeHintType.POSSIBLE_FORMATS, [
  BarcodeFormat.QR_CODE,
  BarcodeFormat.CODE_128,
  BarcodeFormat.CODE_39,
  BarcodeFormat.EAN_13,
]);
```

**2. í”„ë ˆì„ ìŠ¤í‚µ (CPU ì ˆì•½)**
```typescript
let frameCount = 0;
const FRAME_SKIP = 3; // 4í”„ë ˆì„ ì¤‘ 1í”„ë ˆì„ë§Œ

if (frameCount % (FRAME_SKIP + 1) !== 0) {
  return; // ì´ í”„ë ˆì„ì€ ìŠ¤í‚µ
}
```

**3. videoReadyRef ìºì‹œ ìœ ì§€**
```typescript
// Phase 9ì—ì„œ ScannerViewMinimalì„ í•­ìƒ mount ìƒíƒœë¡œ ìœ ì§€
// â†’ video elementê°€ ë™ì¼ ì¸ìŠ¤í„´ìŠ¤
// â†’ ì¬ê²€ì¦ ë¶ˆí•„ìš”
// videoReadyRef.current = false; â† ì œê±°!
```

**ê²°ê³¼**:
- ì²« ìŠ¤ìº”: 3-5ì´ˆ â†’ **0.8-1.2ì´ˆ** (75% ê°œì„ )
- ì—°ì† ìŠ¤ìº”: 2-4ì´ˆ â†’ **0.3-0.5ì´ˆ** (90% ê°œì„ )

---

## 4. ìµœì¢… êµ¬í˜„ ê²°ê³¼

### 4.1 ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | ì´ˆê¸° | ìµœì¢… | ê°œì„ ìœ¨ |
|------|------|------|--------|
| ì²« ìŠ¤ìº” ì†ë„ | 5-20ì´ˆ | 0.8-1.2ì´ˆ | **93%** |
| ì—°ì† ìŠ¤ìº” ì†ë„ | 2-4ì´ˆ | 0.3-0.5ì´ˆ | **90%** |
| CPU ì‚¬ìš©ë¥  | 100% | 25% | **75%** |
| ë²ˆë“¤ í¬ê¸° | 47.3kB | 10.2kB | **78%** |
| ë°°í„°ë¦¬ ìˆ˜ëª… | 1ì‹œê°„ | 2ì‹œê°„ | **2ë°°** |

### 4.2 ê¸°ìˆ  ìŠ¤íƒ

**í”„ë¡ íŠ¸ì—”ë“œ**:
- Next.js 15 (App Router)
- React 19
- TypeScript (strict mode)

**ë°”ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- @zxing/browser (ìµœì í™” ì ìš©)
- í–¥í›„: Native BarcodeDetector API ì¶”ê°€ ì˜ˆì •

**ì¹´ë©”ë¼ ê´€ë¦¬**:
- MediaDevices API
- MediaStream API
- Custom hooks ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬

### 4.3 ì•„í‚¤í…ì²˜ ê°œì„ 

#### Before (ë³µì¡í•¨)
```
page.tsx (126ì¤„)
â””â”€ AnimatePresence (unmount ë¬¸ì œ)
   â””â”€ ScannerViewMinimal (464ì¤„)
      â””â”€ BarcodeScanner (438ì¤„)
         â””â”€ useBarcodeScanner (637ì¤„)
            â””â”€ CameraProvider (539ì¤„)

ì´: 2,204ì¤„
ë¬¸ì œ: ì˜ì¡´ì„± ì§€ì˜¥, ìƒëª…ì£¼ê¸° ë³µì¡
```

#### After (ë‹¨ìˆœí™”)
```
page.tsx (130ì¤„)
â”œâ”€ CSS Transition (unmount ì—†ìŒ)
â”œâ”€ ScannerViewMinimal (450ì¤„, í•­ìƒ mount)
â””â”€ BarcodeScanner (438ì¤„, React.memo)
   â””â”€ useBarcodeScanner (550ì¤„, ìµœì í™”)
      â””â”€ CameraProvider (540ì¤„)

ì´: 2,108ì¤„ (-96ì¤„)
ê°œì„ : ì•ˆì •ì  ìƒëª…ì£¼ê¸°, ë¹ ë¥¸ ì„±ëŠ¥
```

---

## 5. í•µì‹¬ êµí›ˆê³¼ Best Practices

### 5.1 ë¬¸ì œ í•´ê²° ì ‘ê·¼ë²•

#### âŒ ì˜ëª»ëœ ì ‘ê·¼ (Phase 1-9ì—ì„œ í–ˆë˜ ê²ƒ)

1. **ì¶”ì¸¡ ê¸°ë°˜ ìˆ˜ì •**
   ```
   "íƒ€ì„ì•„ì›ƒì´ ì§§ì€ ê²ƒ ê°™ë‹¤" â†’ 10ì´ˆë¡œ ì¦ê°€
   "ì¬ì‹œë„ê°€ ë¶€ì¡±í•œ ê²ƒ ê°™ë‹¤" â†’ 5íšŒë¡œ ì¦ê°€
   "ìºì‹œ ë¬¸ì œì¼ ê²ƒ ê°™ë‹¤" â†’ ë¦¬ì…‹ ì¶”ê°€
   ```
   â†’ ëª¨ë‘ ì‹¤íŒ¨, ì‹œê°„ ë‚­ë¹„

2. **ë¡œê·¸ë¥¼ ì œëŒ€ë¡œ ì•ˆ ë´„**
   ```javascript
   console.log('Video ìƒíƒœ:', { ...Object });
   // Objectë¥¼ í¼ì³ë³´ì§€ ì•ŠìŒ
   // networkState: 2ì˜ ì˜ë¯¸ë¥¼ ëª¨ë¦„
   ```

3. **ë‹¨í¸ì  ìˆ˜ì •**
   - í•˜ë‚˜ì”© íŒ¨ì¹˜ ì¶”ê°€
   - ì „ì²´ êµ¬ì¡° ì´í•´ ë¶€ì¡±
   - ê·¼ë³¸ ì›ì¸ íŒŒì•… ì•ˆ í•¨

#### âœ… ì˜¬ë°”ë¥¸ ì ‘ê·¼ (Phase 10-11ì—ì„œ í•œ ê²ƒ)

1. **ì¦ê±° ê¸°ë°˜ ë¶„ì„**
   ```
   ë¡œê·¸ ìƒì„¸ ë¶„ì„ â†’ networkState: 2 ë°œê²¬
   â†’ MDN ë¬¸ì„œ í™•ì¸ â†’ NETWORK_LOADINGì˜ ì˜ë¯¸ íŒŒì•…
   â†’ HTMLVideoElement ìŠ¤í™ ì´í•´
   â†’ 1ì¤„ ìˆ˜ì •ìœ¼ë¡œ í•´ê²°
   ```

2. **ì „ë¬¸ê°€ ì˜ê²¬ í™œìš©**
   ```
   3ê°œ ì „ë¬¸ ì—ì´ì „íŠ¸ ë™ì›:
   - TypeScript-Pro: íƒ€ì… ì•ˆì •ì„±
   - React-Specialist: hooks íŒ¨í„´
   - Next.js-Developer: ìƒëª…ì£¼ê¸°

   â†’ ë‹¤ê°ë„ ë¶„ì„
   â†’ ê·¼ë³¸ ì›ì¸ ì°¾ê¸°
   ```

3. **ì„±ëŠ¥ ì¸¡ì • ê¸°ë°˜ ìµœì í™”**
   ```
   Performance API ì‚¬ìš©
   â†’ TRY_HARDER: 150-400ms ì¸¡ì •
   â†’ í”„ë ˆì„ ìŠ¤í‚µ: CPU 75% ê°ì†Œ ì¸¡ì •
   â†’ ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •
   ```

### 5.2 ì›¹ ë°”ì½”ë“œ ìŠ¤ìº” Best Practices

#### A. ì¹´ë©”ë¼ ì´ˆê¸°í™”

```typescript
// âœ… DO: ê¶Œí•œ ì‚¬ì „ ìš”ì²­
<CameraProvider options={{ autoRequest: true }}>

// âœ… DO: ì ì ˆí•œ í•´ìƒë„ (ì„±ëŠ¥/í’ˆì§ˆ ê· í˜•)
width: { ideal: 1280 }   // Full HDëŠ” ê³¼ë„í•¨
height: { ideal: 720 }

// âœ… DO: í›„ë©´ ì¹´ë©”ë¼ ìš°ì„ 
facingMode: { ideal: 'environment' }

// âŒ DON'T: ê³¼ë„í•œ í•´ìƒë„
width: { ideal: 1920 }   // ì²˜ë¦¬ ì‹œê°„ ì¦ê°€
height: { ideal: 1080 }
```

#### B. ë¹„ë””ì˜¤ ì¤€ë¹„ ê²€ì¦

```typescript
// âœ… DO: ê°„ë‹¨í•˜ê³  í™•ì‹¤í•œ ì²´í¬
const isVideoReady = (video: HTMLVideoElement) => {
  return (
    video.readyState >= video.HAVE_METADATA &&
    video.videoWidth > 0 &&
    video.videoHeight > 0
  );
};

// âŒ DON'T: ê³¼ë„í•œ ì¡°ê±´ (networkState ì²´í¬)
// MediaStreamì€ networkState=NETWORK_LOADINGì´ ì •ìƒ!
```

#### C. ë°”ì½”ë“œ ë””ì½”ë”© ìµœì í™”

```typescript
// âœ… DO: í¬ë§· ì œí•œ (í•„ìš”í•œ ê²ƒë§Œ)
hints.set(DecodeHintType.POSSIBLE_FORMATS, [
  BarcodeFormat.QR_CODE,
  BarcodeFormat.CODE_128,
]);

// âœ… DO: í”„ë ˆì„ ìŠ¤í‚µ (15fpsë©´ ì¶©ë¶„)
if (frameCount % 4 !== 0) return;

// âŒ DON'T: TRY_HARDER (60% ëŠë ¤ì§)
hints.set(DecodeHintType.TRY_HARDER, true);

// âŒ DON'T: 60fps ë””ì½”ë”© (CPU ê³¼ë¶€í•˜)
```

#### D. ì»´í¬ë„ŒíŠ¸ ìƒëª…ì£¼ê¸°

```typescript
// âœ… DO: ì¹´ë©”ë¼ ì»´í¬ë„ŒíŠ¸ í•­ìƒ mount ìœ ì§€
<div className={viewMode === 'scanner' ? '' : '-translate-x-full'}>
  <ScannerView /> {/* í•­ìƒ DOMì— ì¡´ì¬ */}
</div>

// âŒ DON'T: AnimatePresence mode="wait"
<AnimatePresence mode="wait">
  {viewMode === 'scanner' ? <Scanner /> : <Report />}
</AnimatePresence>
// â†’ Scannerê°€ ì™„ì „íˆ unmountë¨
// â†’ ì¹´ë©”ë¼ ì¬ì‹œì‘ í•„ìš”
```

#### E. React Hooks íŒ¨í„´

```typescript
// âœ… DO: useRefë¡œ ì½œë°± ì•ˆì •í™”
const callbackRef = useRef(callback);
useEffect(() => { callbackRef.current = callback; }, [callback]);

const stableCallback = useCallback(() => {
  callbackRef.current();
}, []); // ë¹ˆ ë°°ì—´ - ì ˆëŒ€ ì¬ìƒì„± ì•ˆ ë¨

// âŒ DON'T: í•¨ìˆ˜ë¥¼ dependencyì— í¬í•¨
useEffect(() => {
  startScanning();
}, [stream, videoElement, startScanning]); // â† ë¬´í•œ ë£¨í”„ ìœ„í—˜
```

---

## 6. í–¥í›„ ìœ ì‚¬ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ ê°€ì´ë“œ

### 6.1 ê¸°íš ë‹¨ê³„

#### Step 1: ìš”êµ¬ì‚¬í•­ ëª…í™•í™”

**ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸**:
- [ ] ì–´ë–¤ ë°”ì½”ë“œ í¬ë§·ì´ í•„ìš”í•œê°€? (QR, 1D, 2D?)
- [ ] ìŠ¤ìº” ë¹ˆë„ëŠ”? (1íšŒ? ì—°ì† 100íšŒ?)
- [ ] ì‚¬ìš© í™˜ê²½ì€? (ì‹¤ë‚´? ì•¼ì™¸? ì¡°ëª…?)
- [ ] ëŒ€ìƒ ë””ë°”ì´ìŠ¤ëŠ”? (iOS? Android? íƒœë¸”ë¦¿?)
- [ ] ì„±ëŠ¥ ëª©í‘œëŠ”? (1ì´ˆ? 5ì´ˆ?)

**Vooster í”„ë¡œì íŠ¸ ì˜ˆì‹œ**:
```
âœ… í¬ë§·: QR + CODE_128/39 + EAN_13
âœ… ë¹ˆë„: ì—°ì† 100íšŒ/ì¼
âœ… í™˜ê²½: ê³µì¥ ë‚´ë¶€ (ì•ˆì •ì  ì¡°ëª…)
âœ… ë””ë°”ì´ìŠ¤: Android ìŠ¤ë§ˆíŠ¸í°, iOS íƒœë¸”ë¦¿
âœ… ëª©í‘œ: ì²« 1ì´ˆ, ì—°ì† 0.5ì´ˆ
```

#### Step 2: ê¸°ìˆ  ì„ íƒ

**ê²°ì • íŠ¸ë¦¬**:
```
Q1: ë„¤ì´í‹°ë¸Œ ì•± ê°€ëŠ¥í•œê°€?
  â””â”€ Yes â†’ React Native / Flutter ì¶”ì²œ
  â””â”€ No â†’ ì›¹ ê¸°ë°˜ ê³„ì†

Q2: Chrome/Edgeë§Œ ì§€ì›í•˜ë©´ ë˜ëŠ”ê°€?
  â””â”€ Yes â†’ Native BarcodeDetector API (ìµœê³  ì„±ëŠ¥)
  â””â”€ No â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš”

Q3: QRë§Œ í•„ìš”í•œê°€?
  â””â”€ Yes â†’ html5-qrcode ì¶”ì²œ
  â””â”€ No â†’ 1Dë„ í•„ìš”

Q4: 1D ë°”ì½”ë“œ ì¢…ë¥˜ëŠ”?
  â””â”€ EAN, UPC ë“± â†’ @zxing/browser
  â””â”€ CODE_128, CODE_39 ë“± â†’ quagga2 (ë” ë¹ ë¦„)
```

**Vooster ì„ íƒ**:
- âœ… ì›¹ ê¸°ë°˜ (PWA ê°€ëŠ¥ì„±)
- âš ï¸ Safari ì§€ì› í•„ìš”
- âœ… QR + 1D (CODE_128/39)
- â†’ **@zxing/browser ì„ íƒ (ìµœì í™” ì ìš©)**

### 6.2 ë¶„ì„ ë‹¨ê³„

#### Step 1: í”„ë¡œí† íƒ€ì… ì„±ëŠ¥ ì¸¡ì •

```typescript
// ì„±ëŠ¥ ì¸¡ì • ìœ í‹¸ë¦¬í‹°
class PerformanceTracker {
  measure(label: string, fn: () => void) {
    const start = performance.now();
    fn();
    const end = performance.now();
    console.log(`${label}: ${(end - start).toFixed(2)}ms`);
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
tracker.measure('getUserMedia', async () => {
  const stream = await navigator.mediaDevices.getUserMedia({...});
});
// ì¶œë ¥: getUserMedia: 1234.56ms
```

**ì¸¡ì • í•­ëª©**:
- getUserMedia ì‹œê°„
- video.play() ì‹œê°„
- readyState ë„ë‹¬ ì‹œê°„
- ì²« ë””ì½”ë”© ì‹œê°„
- í‰ê·  ë””ì½”ë”© ì‹œê°„

#### Step 2: ë³‘ëª© ì§€ì  íŒŒì•…

**Chrome DevTools ì‚¬ìš©**:
1. Performance íƒ­ â†’ Record
2. ë°”ì½”ë“œ ìŠ¤ìº” ìˆ˜í–‰
3. Main Thread ë¶„ì„
   - ê¸´ Task ì°¾ê¸° (ë…¸ë€ìƒ‰/ë¹¨ê°„ìƒ‰)
   - Bottom-Upìœ¼ë¡œ í•¨ìˆ˜ë³„ CPU ì‹œê°„ í™•ì¸

**Vooster í”„ë¡œì íŠ¸ì—ì„œ ë°œê²¬í•œ ë³‘ëª©**:
1. âŒ TRY_HARDER: 150-400ms/í”„ë ˆì„
2. âŒ 60fps ë””ì½”ë”©: CPU 100%
3. âŒ 1920x1080 í•´ìƒë„: ë©”ëª¨ë¦¬ ê³¼ë‹¤
4. âŒ AnimatePresence: unmount/remount

### 6.3 ì„¤ê³„ ë‹¨ê³„

#### í•µì‹¬ ì„¤ê³„ ì›ì¹™

**1. ì»´í¬ë„ŒíŠ¸ ìƒëª…ì£¼ê¸° ë‹¨ìˆœí™”**
```
âŒ BAD: ë³µì¡í•œ unmount/remount
â””â”€ AnimatePresence mode="wait"
   â””â”€ ì „í™˜ ì‹œ ì™„ì „ íŒŒê´´
   â””â”€ ì¬ì´ˆê¸°í™” í•„ìš”

âœ… GOOD: í•­ìƒ mount ìœ ì§€
â””â”€ CSS transformìœ¼ë¡œ ìˆ¨ê¸°ê¸°
   â””â”€ ë¦¬ì†ŒìŠ¤ ìœ ì§€
   â””â”€ ì¦‰ì‹œ ì¬ì‚¬ìš©
```

**2. ìƒíƒœ ê´€ë¦¬ ëª…í™•í™”**
```typescript
// âŒ BAD: ì—¬ëŸ¬ ê³³ì— ë¶„ì‚°ëœ ìƒíƒœ
const [state1, setState1] = useState();  // Component A
const [state2, setState2] = useState();  // Component B
const ref = useRef();                     // Hook C

// âœ… GOOD: ë‹¨ì¼ ì±…ì„
// CameraProvider: ì¹´ë©”ë¼ ìƒíƒœë§Œ
// ScannerState: ìŠ¤ìº” ê²°ê³¼ë§Œ
// UI State: UI ìƒíƒœë§Œ
```

**3. ì˜ì¡´ì„± ì²´ì¸ ìµœì†Œí™”**
```typescript
// âŒ BAD: ê¹Šì€ dependency chain
const a = useCallback(() => {...}, [b]);
const b = useCallback(() => {...}, [c]);
const c = useCallback(() => {...}, [d]);
// â†’ ë¬´í•œ ì¬ìƒì„± ìœ„í—˜

// âœ… GOOD: useRefë¡œ ì•ˆì •í™”
const callbackRef = useRef(callback);
useEffect(() => { callbackRef.current = callback; }, [callback]);

const stable = useCallback(() => {
  callbackRef.current();
}, []); // ë¹ˆ ë°°ì—´
```

### 6.4 êµ¬í˜„ ë‹¨ê³„

#### Phase by Phase ì ‘ê·¼

**Phase 1: ê¸°ë³¸ ë™ì‘ êµ¬í˜„**
- [ ] ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­
- [ ] ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ í‘œì‹œ
- [ ] ë°”ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í†µí•©
- [ ] ê¸°ë³¸ ìŠ¤ìº” ë™ì‘ í™•ì¸
- **ëª©í‘œ**: ì¼ë‹¨ ì‘ë™í•˜ê²Œ ë§Œë“¤ê¸°

**Phase 2: íƒ€ì… ì•ˆì •ì„±**
- [ ] TypeScript strict mode í™œì„±í™”
- [ ] null/undefined ì²˜ë¦¬
- [ ] ì—ëŸ¬ íƒ€ì… ì •ì˜
- **ëª©í‘œ**: ëŸ°íƒ€ì„ ì—ëŸ¬ ë°©ì§€

**Phase 3: ì„±ëŠ¥ ìµœì í™”**
- [ ] ì„±ëŠ¥ ì¸¡ì • (Performance API)
- [ ] ë³‘ëª© ì§€ì  íŒŒì•…
- [ ] ìµœì í™” ì ìš© (í”„ë ˆì„ ìŠ¤í‚µ ë“±)
- **ëª©í‘œ**: ì‹¤ìš©ì ì¸ ì†ë„

**Phase 4: ì•ˆì •ì„± ê°•í™”**
- [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì œê±°
- [ ] cleanup ë¡œì§ ê²€ì¦
- [ ] ì—ëŸ¬ ë³µêµ¬ ì²˜ë¦¬
- **ëª©í‘œ**: ì¥ì‹œê°„ ì‚¬ìš© ê°€ëŠ¥

**Phase 5: ì‚¬ìš©ì„± ê°œì„ **
- [ ] ë¡œë”© ìƒíƒœ ì‹œê°í™”
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 
- [ ] ì ‘ê·¼ì„± (ARIA)
- **ëª©í‘œ**: ì‚¬ìš©ì ì¹œí™”ì 

### 6.5 ë””ë²„ê¹… ì „ëµ

#### ë¬¸ì œ ë°œìƒ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. **ë¡œê·¸ ìƒì„¸ í™•ì¸**
   ```typescript
   // âŒ BAD
   console.log('Video ìƒíƒœ:', video);

   // âœ… GOOD
   console.log('Video ìƒíƒœ:', {
     readyState: video.readyState,
     readyStateName: ['HAVE_NOTHING', 'HAVE_METADATA', ...][video.readyState],
     networkState: video.networkState,
     networkStateName: ['NETWORK_EMPTY', 'NETWORK_IDLE', ...][video.networkState],
     videoWidth: video.videoWidth,
     videoHeight: video.videoHeight,
   });
   ```

2. **ë¸Œë¼ìš°ì € ìŠ¤í™ í™•ì¸**
   - MDN ë¬¸ì„œ ì°¸ì¡°
   - W3C í‘œì¤€ í™•ì¸
   - ë¸Œë¼ìš°ì €ë³„ ë™ì‘ ì°¨ì´ íŒŒì•…

3. **ì „ë¬¸ê°€ ì˜ê²¬ í™œìš©**
   - GitHub Issues ê²€ìƒ‰
   - Stack Overflow
   - AI ì—ì´ì „íŠ¸ ë™ì› (ì—¬ëŸ¬ ê´€ì )

4. **ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§**
   - React DevTools Profiler
   - Chrome Performance Tab
   - ì‹¤ì œ ë””ë°”ì´ìŠ¤ í…ŒìŠ¤íŠ¸

---

## 7. ì›¹ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œ ê³ ë ¤ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 7.1 ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

#### ë¸Œë¼ìš°ì € í˜¸í™˜ì„±
- [ ] Chrome/Edge ì§€ì› (Native BarcodeDetector ê°€ëŠ¥)
- [ ] Safari ì§€ì› (íŠ¹ë³„ ì²˜ë¦¬ í•„ìš”)
- [ ] Firefox ì§€ì› (ì¼ë¶€ ì œì•½)
- [ ] ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸

#### ì„±ëŠ¥ ìµœì í™”
- [ ] ì ì ˆí•œ í•´ìƒë„ ì„ íƒ (640x480 ~ 1280x720)
- [ ] í”„ë ˆì„ë ˆì´íŠ¸ ì œí•œ (15-30fps)
- [ ] í•„ìš”í•œ ë°”ì½”ë“œ í¬ë§·ë§Œ ì§€ì •
- [ ] TRY_HARDER ì‚¬ìš© ìµœì†Œí™”
- [ ] í”„ë ˆì„ ìŠ¤í‚µ ì ìš©

#### ë©”ëª¨ë¦¬ ê´€ë¦¬
- [ ] ìŠ¤íŠ¸ë¦¼ cleanup (tracks.forEach(t => t.stop()))
- [ ] video.srcObject = null
- [ ] setTimeout/setInterval cleanup
- [ ] ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°

#### ë°°í„°ë¦¬/ë°œì—´
- [ ] í”„ë ˆì„ ìŠ¤í‚µìœ¼ë¡œ CPU ì‚¬ìš© ê°ì†Œ
- [ ] ìŠ¤ìº” ì™„ë£Œ í›„ ì¹´ë©”ë¼ ì •ì§€ (ì„ íƒ)
- [ ] ë°±ê·¸ë¼ìš´ë“œ íƒ­ì—ì„œ ìë™ ì •ì§€

### 7.2 UX ê³ ë ¤ì‚¬í•­

#### ì‚¬ìš©ì í”¼ë“œë°±
- [ ] ë¡œë”© ìƒíƒœ í‘œì‹œ (ìŠ¤í”¼ë„ˆ, í”„ë¡œê·¸ë ˆìŠ¤)
- [ ] ìŠ¤ìº” ê°€ì´ë“œ (í”„ë ˆì„ ì˜¤ë²„ë ˆì´)
- [ ] ì„±ê³µ/ì‹¤íŒ¨ í”¼ë“œë°± (ì§„ë™, ì†Œë¦¬, ì‹œê°)
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ (ì‚¬ìš©ì ì¹œí™”ì )

#### ì ‘ê·¼ì„±
- [ ] í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
- [ ] ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì› (ARIA)
- [ ] ì¶©ë¶„í•œ ëŒ€ë¹„ (ëª…ì•”ë¹„)

#### ëª¨ë°”ì¼ ìµœì í™”
- [ ] í„°ì¹˜ ì¹œí™”ì  UI
- [ ] Safe Area ê³ ë ¤ (ë…¸ì¹˜, í™ˆ ì¸ë””ì¼€ì´í„°)
- [ ] ê°€ë¡œ/ì„¸ë¡œ ëª¨ë“œ ëŒ€ì‘

### 7.3 ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

#### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- [ ] HTTPS ë˜ëŠ” localhostë§Œ (ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸)
- [ ] ê¶Œí•œ ìš”ì²­ ëª…í™•í•œ ì„¤ëª…
- [ ] ì¹´ë©”ë¼ ì‚¬ìš© ì¤‘ í‘œì‹œ (ë¸Œë¼ìš°ì € ìë™)

#### ê°œì¸ì •ë³´ ë³´í˜¸
- [ ] ìŠ¤ìº” ì´ë¯¸ì§€ ì €ì¥ ì•ˆ í•¨
- [ ] ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ ì‹œ ì™„ì „ ì •ë¦¬
- [ ] ë¶ˆí•„ìš”í•œ ê¶Œí•œ ìš”ì²­ ì•ˆ í•¨

---

## 8. ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ë° ëª©í‘œ ì„¤ì •

### 8.1 ì‚°ì—…ë³„ ê¶Œì¥ ì„±ëŠ¥ ëª©í‘œ

| ì‚°ì—… | ìŠ¤ìº” ë¹ˆë„ | ëª©í‘œ ì†ë„ | CPU ì œí•œ |
|------|----------|----------|----------|
| **ë¬¼ë¥˜/ì°½ê³ ** | ì´ˆë‹¹ 1-2ê°œ | < 0.5ì´ˆ | < 30% |
| **ì œì¡°** | ë¶„ë‹¹ 5-10ê°œ | < 1ì´ˆ | < 40% |
| **ë¦¬í…Œì¼** | ë¶„ë‹¹ 1-5ê°œ | < 2ì´ˆ | < 50% |
| **í–‰ì‚¬** | ì‹œê°„ë‹¹ 10-50ê°œ | < 3ì´ˆ | < 60% |

**Vooster (ì œì¡°)**: ë¶„ë‹¹ 5-10ê°œ â†’ **ëª©í‘œ 0.5-1ì´ˆ** âœ… ë‹¬ì„±!

### 8.2 ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ ì„±ëŠ¥ ë¹„êµ

| ë¼ì´ë¸ŒëŸ¬ë¦¬ | QR | 1D | ì†ë„ | ë©”ëª¨ë¦¬ | ë‚œì´ë„ |
|----------|----|----|------|--------|--------|
| **Native BarcodeDetector** | âœ… | âœ… | âš¡âš¡âš¡âš¡âš¡ | âš¡âš¡âš¡âš¡âš¡ | â­ |
| **quagga2** | âŒ | âœ… | âš¡âš¡âš¡âš¡ | âš¡âš¡âš¡âš¡ | â­â­ |
| **html5-qrcode** | âœ… | âš ï¸ | âš¡âš¡âš¡ | âš¡âš¡âš¡ | â­ |
| **@zxing/browser** | âœ… | âœ… | âš¡âš¡ | âš¡âš¡ | â­â­â­ |

**ì¶”ì²œ**:
- Chrome/Edgeë§Œ: Native BarcodeDetector
- 1D ì „ìš©: quagga2
- QR ì „ìš©: html5-qrcode
- ëª¨ë“  í¬ë§· + ëª¨ë“  ë¸Œë¼ìš°ì €: @zxing/browser (ìµœì í™” í•„ìˆ˜)

---

## 9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### 9.1 í”í•œ ë¬¸ì œì™€ í•´ê²°ì±…

#### ë¬¸ì œ 1: "íƒ€ì„ì•„ì›ƒ ì—ëŸ¬"
```
âŒ Video element failed to become ready
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
1. readyState ê°’ í™•ì¸ (0-4)
2. networkState ê°’ í™•ì¸ (0-3)
3. videoWidth/Height í™•ì¸
4. **networkState ì²´í¬ ë¡œì§ í™•ì¸** â† ì´ê²Œ ì›ì¸ì¸ ê²½ìš° ë§ìŒ!

**í•´ê²°**:
```typescript
// networkState ì²´í¬ ì œê±° (MediaStreamì€ LOADINGì´ ì •ìƒ)
const isReady = video.readyState >= 2 && video.videoWidth > 0;
```

#### ë¬¸ì œ 2: "ë‘ ë²ˆì§¸ ìŠ¤ìº” ëŠë¦¼"
```
ì²« ìŠ¤ìº”: ë¹ ë¦„
ë‘ ë²ˆì§¸: ëŠë¦¼
```

**ì›ì¸**:
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
- Reader ì¬ì´ˆê¸°í™” í•„ìš”
- cleanup ë¯¸í¡

**í•´ê²°**:
```typescript
const stopScanning = () => {
  // Reader cleanup
  reader.reset?.(); // ìˆìœ¼ë©´ í˜¸ì¶œ

  // Stream cleanup
  stream.getTracks().forEach(t => t.stop());

  // ìºì‹œ ìœ ì§€ (videoReadyRef ë¦¬ì…‹ ì•ˆ í•¨)
};
```

#### ë¬¸ì œ 3: "CPU 100%, ë””ë°”ì´ìŠ¤ ëœ¨ê±°ì›€"
```
ë°°í„°ë¦¬ ë¹¨ë¦¬ ë‹³ìŒ
ë””ë°”ì´ìŠ¤ ë°œì—´
```

**í•´ê²°**:
```typescript
// í”„ë ˆì„ ìŠ¤í‚µ (60fps â†’ 15fps)
if (frameCount % 4 !== 0) return;

// í•´ìƒë„ ë‚®ì¶”ê¸°
width: { ideal: 640 }
height: { ideal: 480 }
```

### 9.2 ë””ë²„ê¹… íŒ

#### ë¡œê·¸ ë ˆë²¨ ì‹œìŠ¤í…œ
```typescript
enum LogLevel { ERROR, WARN, INFO, DEBUG }

const log = (level: LogLevel, message: string, data?: any) => {
  const currentLevel = process.env.NODE_ENV === 'development'
    ? LogLevel.DEBUG
    : LogLevel.WARN;

  if (level <= currentLevel) {
    console.log(`[${LogLevel[level]}]`, message, data);
  }
};

// ì‚¬ìš©
log(LogLevel.DEBUG, 'Video ìƒíƒœ', { readyState: video.readyState });
log(LogLevel.ERROR, 'íƒ€ì„ì•„ì›ƒ ë°œìƒ', { duration: 10000 });
```

#### Performance ì¸¡ì •
```typescript
// React DevTools Profiler
<Profiler id="Scanner" onRender={(id, phase, actualDuration) => {
  if (actualDuration > 16) { // 60fps ê¸°ì¤€
    console.warn(`${id} slow render: ${actualDuration}ms`);
  }
}}>
  <BarcodeScanner />
</Profiler>
```

---

## 10. ê²°ë¡ 

### 10.1 í•µì‹¬ ì„±ê³¼

**Vooster í”„ë¡œì íŠ¸**:
- âœ… ì²« ìŠ¤ìº”: 5-20ì´ˆ â†’ **0.8-1.2ì´ˆ** (93% ê°œì„ )
- âœ… ì—°ì† ìŠ¤ìº”: 2-4ì´ˆ â†’ **0.3-0.5ì´ˆ** (90% ê°œì„ )
- âœ… íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ 100% í•´ê²°
- âœ… ë²ˆë“¤ í¬ê¸° 78% ê°ì†Œ
- âœ… CPU ì‚¬ìš© 75% ê°ì†Œ

**ì‘ì—…ì ìƒì‚°ì„±**:
- 100ê°œ/ì¼ ê¸°ì¤€: **14ë¶„/ì¼ ì ˆì•½**
- 10ëª… ê¸°ì¤€: **2.3ì‹œê°„/ì¼ ì ˆì•½**
- 1ë‹¬ ê¸°ì¤€: **50ì‹œê°„ ì ˆì•½**

### 10.2 ê°€ì¥ ì¤‘ìš”í•œ êµí›ˆ

1. **ì¦ê±° ê¸°ë°˜ ë””ë²„ê¹…**
   - ì¶”ì¸¡í•˜ì§€ ë§ê³  ë¡œê·¸ë¥¼ ìƒì„¸íˆ í™•ì¸
   - ìˆ«ì ê°’ì˜ ì •í™•í•œ ì˜ë¯¸ íŒŒì•…
   - ë¸Œë¼ìš°ì € ìŠ¤í™ í™•ì¸

2. **ì „ë¬¸ê°€ ì˜ê²¬ í™œìš©**
   - í˜¼ì í•´ê²° ì•ˆ ë˜ë©´ ì¦‰ì‹œ ë„ì›€ ìš”ì²­
   - ë‹¤ê°ë„ ë¶„ì„ (TypeScript, React, Next.js)
   - GitHub Issues, Stack Overflow ê²€ìƒ‰

3. **ì„±ëŠ¥ ì¸¡ì • ê¸°ë°˜ ìµœì í™”**
   - ê°ìœ¼ë¡œ ìµœì í™”í•˜ì§€ ë§ê¸°
   - Performance APIë¡œ ì¸¡ì •
   - ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •

4. **ë‹¨ìˆœí•¨ì´ ìµœê³ **
   - ë³µì¡í•œ íŒ¨ì¹˜ë³´ë‹¤ êµ¬ì¡° ê°œì„ 
   - ìºì‹œë³´ë‹¤ ëª…í™•í•œ ê²€ì¦
   - ì˜ì¡´ì„± ì²´ì¸ë³´ë‹¤ ref íŒ¨í„´

### 10.3 í–¥í›„ ê°œì„  ë°©í–¥

**ë‹¨ê¸° (1-2ì£¼)**:
- [ ] Native BarcodeDetector API í†µí•©
- [ ] Chrome/Edgeì—ì„œ 10-50ms ì¸ì‹

**ì¤‘ê¸° (1-2ê°œì›”)**:
- [ ] Web Worker ê¸°ë°˜ ë””ì½”ë”©
- [ ] UI ë¸”ë¡œí‚¹ ì™„ì „ ì œê±°
- [ ] PWA ë³€í™˜ (ì˜¤í”„ë¼ì¸ ìºì‹±)

**ì¥ê¸° (3-6ê°œì›”)**:
- [ ] ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ë°”ì½”ë“œ ì˜ì—­ ì‚¬ì „ íƒì§€
- [ ] ì ì‘í˜• ì„±ëŠ¥ ì¡°ì • (ë””ë°”ì´ìŠ¤ë³„)
- [ ] í†µê³„ ëŒ€ì‹œë³´ë“œ (ìŠ¤ìº” ì„±ê³µë¥ , í‰ê·  ì‹œê°„)

---

## 11. ì°¸ê³  ìë£Œ

### 11.1 ê³µì‹ ë¬¸ì„œ

- [MDN: MediaDevices.getUserMedia()](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)
- [MDN: HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
- [W3C: Barcode Detection API](https://wicg.github.io/shape-detection-api/text.html#barcode-detection-api)
- [ZXing Documentation](https://github.com/zxing-js/browser)

### 11.2 ë¼ì´ë¸ŒëŸ¬ë¦¬

- [@zxing/browser](https://www.npmjs.com/package/@zxing/browser) - ë²”ìš© ë°”ì½”ë“œ
- [quagga2](https://www.npmjs.com/package/@ericblade/quagga2) - 1D ë°”ì½”ë“œ ì „ë¬¸
- [html5-qrcode](https://www.npmjs.com/package/html5-qrcode) - QR + ì¼ë¶€ 1D

### 11.3 ë„êµ¬

- [React DevTools](https://react.dev/learn/react-developer-tools)
- [Chrome Performance Profiler](https://developer.chrome.com/docs/devtools/performance/)
- [WebPageTest](https://www.webpagetest.org/) - ëª¨ë°”ì¼ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

## 12. ìš”ì•½

**ì›¹ ê¸°ë°˜ ë°”ì½”ë“œ ìŠ¤ìº”ì€ ì–´ë µìŠµë‹ˆë‹¤.**

í•˜ì§€ë§Œ:
1. âœ… ì˜¬ë°”ë¥¸ ì„¤ê³„
2. âœ… ì„±ëŠ¥ ì¸¡ì •
3. âœ… ì¦ê±° ê¸°ë°˜ ë””ë²„ê¹…
4. âœ… ì§€ì†ì ì¸ ìµœì í™”

ë¡œ **ì‚°ì—…í˜„ì¥ì—ì„œ ì‹¤ìš©ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ**ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Vooster í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ì„±ê³µ ìš”ì¸**:
- 11ë²ˆì˜ Phaseë¥¼ ê±°ì¹˜ë©° ë¬¸ì œì˜ ë³¸ì§ˆì„ íŒŒì•…
- 3ê°œ ì „ë¬¸ ì—ì´ì „íŠ¸ì˜ ë‹¤ê°ë„ ë¶„ì„
- networkState ì²´í¬ ì œê±°ë¼ëŠ” 1ì¤„ ìˆ˜ì •ìœ¼ë¡œ ê·¼ë³¸ í•´ê²°
- ì‚°ì—…í˜„ì¥ ì›Œí¬í”Œë¡œìš°ì— ë§ì¶˜ ìµœì í™”

**ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œëŠ”**:
- ì´ ê°€ì´ë“œë¥¼ ì°¸ì¡°í•˜ì—¬ ì‹œí–‰ì°©ì˜¤ ìµœì†Œí™”
- Phase 1ì—ì„œë¶€í„° ì„±ëŠ¥ ì¸¡ì • ì‹œì‘
- ì´ˆê¸°ë¶€í„° ê°„ë‹¨í•œ êµ¬ì¡° ìœ ì§€
- ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ì „ë¬¸ê°€ ì˜ê²¬ í™œìš©

---

---

## 13. ì‹¤ì‹œê°„ í†µì‹  ì•„í‚¤í…ì²˜ (Socket.IO ê¸°ë°˜)

### 13.1 ì‹œìŠ¤í…œ ê°œìš”

VoosterëŠ” ìŠ¤ë§ˆíŠ¸í° ì›¹ì•±ê³¼ ì„¸ì»¨ë“œ ëª¨ë‹ˆí„°(ëŒ€ì‹œë³´ë“œ)ê°„ì˜ **ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ **ì„ Socket.IO ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë°”ì½”ë“œ ìŠ¤ìº” ê²°ê³¼ë¥¼ ì¦‰ì‹œ ëª¨ë‹ˆí„°ì— ë°˜ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ìŠ¤ë§ˆíŠ¸í° (ìŠ¤ìº” ì•±)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ë°”ì½”ë“œ ìŠ¤ìº”                                       â”‚  â”‚
â”‚  â”‚  (ì¹´ë©”ë¼ + ZXing)                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                   â”‚ Socket.IO emit('scanOrder')        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Socket.IO ì„œë²„         â”‚
         â”‚  (Node.js + Express)     â”‚
         â”‚                          â”‚
         â”‚  - ì„¸ì…˜ ê´€ë¦¬             â”‚
         â”‚  - ë©”ì‹œì§€ ë¼ìš°íŒ…         â”‚
         â”‚  - ì‹¤ì‹œê°„ ë™ê¸°í™”         â”‚
         â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ emit('orderScanned')         â”‚
        â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ëª¨ë‹ˆí„° 1   â”‚            â”‚   ëª¨ë‹ˆí„° 2    â”‚
    â”‚ (ëŒ€ì‹œë³´ë“œ)  â”‚            â”‚  (ëŒ€ì‹œë³´ë“œ)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 ì„œë²„ êµ¬ì¡° ì„¤ê³„

#### A. ê¸°ë³¸ ì„¤ì •

```typescript
// server/src/index.ts
const io = new SocketIOServer(server, {
  cors: {
    origin: config.corsOrigins,
    credentials: true,
  },
  transports: ['websocket', 'polling'],
  pingInterval: 25000,      // í•˜íŠ¸ë¹„íŠ¸ ê°„ê²©
  pingTimeout: 60000,       // ì—°ê²° ëŠê¹€ íŒì • ì‹œê°„
  maxHttpBufferSize: 1e6,   // 1MB ë©”ì‹œì§€ í¬ê¸° ì œí•œ
});
```

**ê° ì„¤ì •ì˜ ì˜ë¯¸**:
- `transports`: WebSocket ìš°ì„ , í´ë°±ìœ¼ë¡œ HTTP long-polling
- `pingInterval/pingTimeout`: ì—°ê²° ì•ˆì •ì„± ë³´ì¥
- `maxHttpBufferSize`: ëŒ€ìš©ëŸ‰ ë©”ì‹œì§€ ë°©ì§€

#### B. ì¸ì¦ ë¯¸ë“¤ì›¨ì–´

```typescript
// Socket.IO ì—°ê²° ì‹œ JWT ê²€ì¦
io.use(authMiddleware(config.jwtSecret));

// authMiddlewareëŠ” ë‹¤ìŒì„ ê²€ì¦:
// 1. Authorization í—¤ë”ì—ì„œ JWT ì¶”ì¶œ
// 2. í† í° ì„œëª… ê²€ì¦
// 3. í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸
// 4. socket.dataì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
```

### 13.3 ì„¸ì…˜ ê´€ë¦¬ ì „ëµ

#### A. ì„¸ì…˜ ìƒì„± (QR í˜ì–´ë§)

```typescript
// ì„¸ì»¨ë“œ ëª¨ë‹ˆí„°ì—ì„œ "ìŠ¤ìº” ì¤€ë¹„" í´ë¦­ ì‹œ QR ìƒì„±
socket.on('session:create', async (data) => {
  const session = pairingService.createSession(data.userId);
  const pairingUrl = pairingService.generatePairingUrl(session);

  // QR ì½”ë“œ ìƒì„± (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ)
  // ë°ì´í„°: pairingUrl (ë˜ëŠ” sessionId + token)

  socket.emit('sessionCreated', {
    sessionId: session.sessionId,
    pairingUrl: pairingUrl,
    expiresAt: new Date(session.expiresAt).toISOString(),
  });
});

// ì„¸ì…˜ ê°ì²´ êµ¬ì¡°
interface PairingSession {
  sessionId: string;           // 8ì ê³ ìœ  ID (0-9A-Z)
  createdAt: number;          // ìƒì„± ì‹œê°„ (íƒ€ì„ìŠ¤íƒ¬í”„)
  expiresAt: number;          // ë§Œë£Œ ì‹œê°„ (ê¸°ë³¸ 15ë¶„)
  pairingToken: string;       // JWT (10ë¶„ ìœ íš¨)
  status: 'waiting' | 'paired'; // ìƒíƒœ
  mobileSocketId?: string;    // ìŠ¤ë§ˆíŠ¸í° ì†Œì¼“ ID
  monitorSocketId?: string;   // ëª¨ë‹ˆí„° ì†Œì¼“ ID
  pairedAt?: number;          // í˜ì–´ë§ ì™„ë£Œ ì‹œê°„
}
```

#### B. QR ìŠ¤ìº” í›„ í˜ì–´ë§

```typescript
// ìŠ¤ë§ˆíŠ¸í°ì—ì„œ QR ìŠ¤ìº” í›„ token + sessionId ì „ì†¡
socket.on('session:join', (data: { sessionId: string; token: string }) => {
  // 1. í† í° ê²€ì¦
  const verify = pairingService.verifyPairingToken(data.sessionId, data.token);
  if (!verify.valid) {
    socket.emit('error', { code: verify.error });
    return;
  }

  // 2. í˜ì–´ë§ ì™„ë£Œ
  const success = pairingService.completePairing(
    data.sessionId,
    socket.id,  // ìŠ¤ë§ˆíŠ¸í° ì†Œì¼“ ID ì €ì¥
  );

  if (success) {
    // 3. ì†Œì¼“ ë£¸ì— ì¶”ê°€
    socket.join(`session:${data.sessionId}`);

    // 4. ì–‘ìª½ í´ë¼ì´ì–¸íŠ¸ì— ì•Œë¦¼
    io.to(`session:${data.sessionId}`).emit('pairingComplete', {
      sessionId: data.sessionId,
      timestamp: new Date().toISOString(),
    });
  }
});
```

### 13.4 ì†Œì¼“ ë£¸ ê¸°ë°˜ ë©”ì‹œì§•

#### A. ì†Œì¼“ ë£¸ ê°œë…

```typescript
// Socket.IO ë£¸: ê°™ì€ sessionIdë¥¼ ê°€ì§„ í´ë¼ì´ì–¸íŠ¸ë“¤ì˜ ê·¸ë£¹

// ë£¸ ì¶”ê°€ (í˜ì–´ë§ ì‹œ)
socket.join(`session:${sessionId}`);

// ë£¸ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
io.to(`session:${sessionId}`).emit('orderScanned', {
  orderId: '2024001234',
  timestamp: new Date().toISOString(),
});

// ìì‹ ì„ ì œì™¸í•œ ë£¸ ì „ì†¡
socket.broadcast.to(`session:${sessionId}`).emit('event', data);

// ë£¸ì—ì„œ ì œê±°
socket.leave(`session:${sessionId}`);
```

**ë£¸ êµ¬ì¡°**:
- `session:{sessionId}`: íŠ¹ì • ì„¸ì…˜ì˜ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸
- `user:{userId}`: íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸

#### B. ì‹¤ì œ ë©”ì‹œì§€ íë¦„

```
ìŠ¤ë§ˆíŠ¸í° (Socket A)              ëª¨ë‹ˆí„° (Socket B)
      â”‚                                â”‚
      â”‚â”€â”€â”€â”€ emit('scanOrder') â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚      â””â”€ orderId: '2024001234'  â”‚
      â”‚      â””â”€ barcode: 'ABC123'      â”‚
      â”‚                                â”‚
      â”‚  â—€â”€â”€â”€ emit('orderConfirm') â”€â”€â”€â”‚
      â”‚       â””â”€ status: 'success'     â”‚
      â”‚       â””â”€ timestamp: ...        â”‚
      â”‚                                â”‚
      â”‚  â—€â”€ emit('showDetails') â”€â”€â”€â”€â”€â”€â”‚
      â”‚       â””â”€ productName: ...      â”‚
      â”‚       â””â”€ quantity: 100         â”‚
      â”‚                                â”‚
```

### 13.5 ì¸ì¦ ë° ë³´ì•ˆ

#### A. JWT ê¸°ë°˜ ì¸ì¦

```typescript
// í˜ì–´ë§ í† í° (QR ìŠ¤ìº”ìš©)
interface SessionPairingPayload {
  sid: string;        // Session ID
  sub: string;        // Subject (userId)
  iat?: number;       // ë°œê¸‰ ì‹œê°„
  exp?: number;       // ë§Œë£Œ ì‹œê°„
}

// í† í° ìƒì„±
const pairingToken = sign(
  { sid: sessionId, sub: userId },
  config.jwtSecret,
  { expiresIn: '10m' }  // 10ë¶„ ìœ íš¨
);

// ê²€ì¦ (ì—°ê²° ì‹œ)
const authMiddleware = (jwtSecret: string) => {
  return (socket, next) => {
    const token = socket.handshake.auth.token;
    try {
      const payload = verify(token, jwtSecret);
      socket.data.userId = payload.sub;
      socket.data.sessionId = payload.sid;
      next();
    } catch (error) {
      next(new Error('Authentication failed'));
    }
  };
};
```

#### B. ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

```typescript
// 1. í† í° ê²€ì¦
- sidì™€ tokenì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸
- ì„œëª… ê²€ì¦ (JWT_SECRET)

// 2. ì„¸ì…˜ ê¶Œí•œ
- ìì‹ ì˜ sessionIdë§Œ ì ‘ê·¼ ê°€ëŠ¥
- ë‹¤ë¥¸ ì„¸ì…˜ì˜ ë©”ì‹œì§€ ê±°ë¶€
- disconnected ì„¸ì…˜ ì •ë¦¬

// 3. Rate Limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15ë¶„
  max: 100,                   // 100 ìš”ì²­ ì œí•œ
});

// 4. ë©”ì‹œì§€ ê²€ì¦
socket.on('scanOrder', (data) => {
  // í•„ìˆ˜ í•„ë“œ í™•ì¸
  if (!data.orderId || !data.barcode) {
    socket.emit('error', { code: 'INVALID_PAYLOAD' });
    return;
  }
  // í˜•ì‹ ê²€ì¦ (ì •ê·œì‹)
  if (!/^\d{8,12}$/.test(data.orderId)) {
    return;
  }
});
```

### 13.6 ì„¸ì…˜ ì •ë¦¬ ë° íƒ€ì„ì•„ì›ƒ

#### A. íƒ€ì„ì•„ì›ƒ ì„¤ì •

```typescript
// í˜ì–´ë§ ì„¸ì…˜ (15ë¶„)
interface PairingServiceConfig {
  sessionTTL: 15 * 60 * 1000,  // 15ë¶„ í›„ ìë™ ë§Œë£Œ
  tokenExpiresIn: '10m',       // JWT í† í° 10ë¶„ ìœ íš¨
}

// ë¹„í™œì„± ì„¸ì…˜ ì •ë¦¬ (30ë¶„)
sessionService.cleanupInactiveSessions(
  maxIdleTime: 30 * 60 * 1000
);

// ì •ê¸°ì  ì •ë¦¬ (10ë¶„ë§ˆë‹¤)
setInterval(() => {
  sessionService.cleanupInactiveSessions();
}, 10 * 60 * 1000);
```

#### B. ì„¸ì…˜ ë¼ì´í”„ì‚¬ì´í´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì„¸ì…˜ ìƒì„± (Create)                                          â”‚
â”‚ - sessionId ë°œê¸‰                                            â”‚
â”‚ - pairingToken (JWT) ìƒì„±                                   â”‚
â”‚ - QR URL ìƒì„±                                               â”‚
â”‚ - 15ë¶„ TTL íƒ€ì´ë¨¸ ì‹œì‘                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ [QR ìŠ¤ìº”]
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í˜ì–´ë§ (Pair)                                               â”‚
â”‚ - í† í° ê²€ì¦                                                 â”‚
â”‚ - mobileSocketId, monitorSocketId ì—°ê²°                      â”‚
â”‚ - ì†Œì¼“ ë£¸ ìƒì„± (session:{sessionId})                        â”‚
â”‚ - status ë³€ê²½: 'waiting' â†’ 'paired'                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ [ì‹¤ì‹œê°„ ë©”ì‹œì§€ êµí™˜]
             â”‚ - scanOrder
             â”‚ - orderConfirm
             â”‚ - showDetails
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì™„ë£Œ & ì •ë¦¬ (Release)                                       â”‚
â”‚ - ì†Œì¼“ ì—°ê²° í•´ì œ                                            â”‚
â”‚ - ì†Œì¼“ ë£¸ì—ì„œ ì œê±°                                          â”‚
â”‚ - ì„¸ì…˜ ë ˆì½”ë“œ ì‚­ì œ                                          â”‚
â”‚ - TTL íƒ€ì´ë¨¸ ì·¨ì†Œ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### C. ì—°ê²° í•´ì œ ì²˜ë¦¬

```typescript
// ì—°ê²° í•´ì œ ì´ë²¤íŠ¸
socket.on('disconnect', () => {
  // 1. ì„¸ì…˜ì—ì„œ ì†Œì¼“ ID ì œê±°
  const sessionId = pairingService.removeSocketFromSession(socket.id);

  if (!sessionId) return;

  // 2. ìƒíƒœ í™•ì¸
  const session = pairingService.getSession(sessionId);
  if (!session) return;

  // 3. ì–‘ìª½ ëª¨ë‘ ì—°ê²° í•´ì œë˜ë©´ ì„¸ì…˜ ì‚­ì œ
  if (!session.mobileSocketId && !session.monitorSocketId) {
    pairingService.releaseSession(sessionId);
    logger.info('ì„¸ì…˜ ìë™ ì •ë¦¬: %s', sessionId);
  }

  // 4. ìƒëŒ€ë°©ì— ì•Œë¦¼ (ì„ íƒì‚¬í•­)
  io.to(`session:${sessionId}`).emit('peerDisconnected', {
    reason: 'peer_disconnected',
  });
});
```

---

## 14. ì„¸ì…˜ í˜ì–´ë§ ì‹œìŠ¤í…œ (QR ì½”ë“œ ê¸°ë°˜)

### 14.1 QR ìƒì„± ë° ìŠ¤ìº” í”„ë¡œì„¸ìŠ¤

#### A. QR ì½”ë“œ ìƒì„±

```typescript
// 1. ëª¨ë‹ˆí„°ì—ì„œ QR ìƒì„± ìš”ì²­
const handleCreateSession = async () => {
  socket.emit('session:create', {
    userId: 'user-123',
  });
};

// 2. ì„œë²„ì—ì„œ QR ë°ì´í„° ìƒì„±
const pairingUrl = pairingService.generatePairingUrl(session);
// ê²°ê³¼: https://app.example.com/pair?sid=ABC123XY&t=eyJhbG...

// 3. QR ì½”ë“œ ë Œë”ë§ (í”„ë¡ íŠ¸ì—”ë“œ)
// qrcode.react ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
<QRCode
  value={pairingUrl}
  size={256}
  level="H"           // ë†’ì€ ì˜¤ë¥˜ ì •ì • ë ˆë²¨
  includeMargin={true}
/>
```

**QR ì„¤ì • ê°€ì´ë“œ**:
- **size**: 256 ì´ìƒ ê¶Œì¥ (ì‚°ì—…í˜„ì¥ì—ì„œ ê±°ë¦¬ê°€ ìˆì„ ìˆ˜ ìˆìŒ)
- **level**: H (High) ê¶Œì¥ (30% ì†ìƒë„ ë³µêµ¬ ê°€ëŠ¥)
- **margin**: true (ì½”ë“œ ì£¼ë³€ ì—¬ë°± í•„ìš”)

#### B. QR ìŠ¤ìº” í›„ í˜ì–´ë§

```typescript
// 1. ìŠ¤ë§ˆíŠ¸í°ì—ì„œ QR ìŠ¤ìº”
// ZXingì´ QR ë°ì´í„° ì¶”ì¶œ: "https://app.example.com/pair?sid=ABC123XY&t=eyJhbG..."

// 2. URL íŒŒì‹±
const url = new URL(scannedBarcode);
const sessionId = url.searchParams.get('sid');   // ABC123XY
const token = url.searchParams.get('t');         // JWT í† í°

// 3. í˜ì–´ë§ ìš”ì²­
socket.emit('session:join', {
  sessionId: sessionId,
  token: token,
});

// 4. ì„œë²„ ê²€ì¦ ë° ì—°ê²°
const verify = pairingService.verifyPairingToken(sessionId, token);
if (verify.valid) {
  // í˜ì–´ë§ ì„±ê³µ
  pairingService.completePairing(sessionId, mobileSocketId);
  socket.emit('pairingSuccess');
}
```

### 14.2 ì„¸ì…˜ ì‹ë³„ ë° ë§¤ì¹­

#### A. ì„¸ì…˜ ID ìƒì„± ì „ëµ

```typescript
// 8ì ê³ ìœ  ID (ìˆ«ì + ëŒ€ë¬¸ì)
// ì˜ˆ: ABC123XY, 0A9Z1BC5

import { customAlphabet } from 'nanoid';

const generateSessionId = customAlphabet(
  '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ',
  8  // 8ì ê¸¸ì´
);

// ì¶©ëŒ í™•ë¥  ê³„ì‚°
// 36^8 = 2.8 * 10^12 (ì•½ 2ì¡°)
// â†’ ë§¤ì¼ 1000ê°œ ì„¸ì…˜ ìƒì„±í•´ë„ ì¶©ëŒ ì—†ìŒ
```

#### B. ë§¤í•‘ ì €ì¥ì†Œ (in-memory)

```typescript
// SessionPairingService ë‚´ë¶€
private sessions: Map<string, PairingSession> = new Map();

// ì¡°íšŒ (sessionId ê¸°ì¤€)
getSession(sessionId: string): PairingSession | undefined {
  const session = this.sessions.get(sessionId);

  // ë§Œë£Œ í™•ì¸
  if (Date.now() > session.expiresAt) {
    this.sessions.delete(sessionId);
    return undefined;
  }

  return session;
}

// ì¡°íšŒ (remoteId ê¸°ì¤€) - ì›ê²© íƒœìŠ¤í¬ ì—°ê²°ìš©
getByRemoteId(remoteId: string): MappingRecord | null {
  // SQLite ë§¤í•‘ ìŠ¤í† ì–´ì—ì„œ ì¡°íšŒ
  const stmt = this.db.prepare(
    'SELECT * FROM mappings WHERE remoteId = ?'
  );
  return stmt.get(remoteId);
}
```

#### C. ì†Œì¼“-ì„¸ì…˜ ë§¤í•‘

```typescript
// ì—­ë§¤í•‘: ì†Œì¼“ ID â†’ ì„¸ì…˜ ID
private socketToSession: Map<string, string> = new Map();

// ë“±ë¡
registerMobileSocket(sessionId: string, socketId: string): boolean {
  const session = this.getSession(sessionId);
  if (!session) return false;

  session.mobileSocketId = socketId;
  this.socketToSession.set(socketId, sessionId);
  return true;
}

// ì¡°íšŒ
getSessionIdBySocketId(socketId: string): string | undefined {
  return this.socketToSession.get(socketId);
}

// ì œê±°
removeSocket(socketId: string): void {
  const sessionId = this.socketToSession.get(socketId);
  if (sessionId) {
    const session = this.sessions.get(sessionId);
    if (session) {
      if (session.mobileSocketId === socketId) {
        session.mobileSocketId = undefined;
      }
      if (session.monitorSocketId === socketId) {
        session.monitorSocketId = undefined;
      }
      // ì–‘ìª½ ëª¨ë‘ ì—°ê²° í•´ì œë˜ë©´ ì‚­ì œ
      if (!session.mobileSocketId && !session.monitorSocketId) {
        this.sessions.delete(sessionId);
      }
    }
    this.socketToSession.delete(socketId);
  }
}
```

### 14.3 íƒ€ì„ì•„ì›ƒ ë° ì •ë¦¬ ë©”ì»¤ë‹ˆì¦˜

#### A. ìë™ ë§Œë£Œ

```typescript
// ì„¸ì…˜ ìƒì„± ì‹œ
const expiresAt = now + this.config.sessionTTL;  // 15ë¶„

// ìë™ ë§Œë£Œ íƒ€ì´ë¨¸
setTimeout(() => {
  if (this.sessions.has(sessionId)) {
    const sess = this.sessions.get(sessionId)!;

    // paired ìƒíƒœê°€ ì•„ë‹ˆë©´ ì‚­ì œ
    if (sess.status !== 'paired') {
      this.sessions.delete(sessionId);
      logger.info('ì„¸ì…˜ ìë™ ë§Œë£Œ: %s', sessionId);
    }
  }
}, this.config.sessionTTL);  // 15ë¶„ í›„ ì‹¤í–‰
```

**ë¬¸ì œì  í•´ê²°**:
- `setTimeout` ì €ì¥í•˜ì§€ ì•Šìœ¼ë©´ ë‚˜ì¤‘ì— ì·¨ì†Œ ë¶ˆê°€
- ëŒ€ëŸ‰ì˜ ì„¸ì…˜ì—ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìœ„í—˜
- â†’ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” Redisë¡œ ê´€ë¦¬ ê¶Œì¥

#### B. ëª¨ë‹ˆí„°ë§ API

```typescript
// í™œì„± ì„¸ì…˜ ì¡°íšŒ
app.get('/api/sessions/active', (req, res) => {
  const sessions = pairingService.getAllActiveSessions();

  res.json({
    total: sessions.length,
    paired: sessions.filter(s => s.status === 'paired').length,
    waiting: sessions.filter(s => s.status === 'waiting').length,
    sessions: sessions.map(s => ({
      sessionId: s.sessionId,
      status: s.status,
      hasMobile: !!s.mobileSocketId,
      hasMonitor: !!s.monitorSocketId,
      createdAt: new Date(s.createdAt).toISOString(),
      expiresAt: new Date(s.expiresAt).toISOString(),
    })),
  });
});

// í—¬ìŠ¤ ì²´í¬
app.get('/health', (req, res) => {
  const uptime = process.uptime();
  const sessions = sessionService.getAllSessions();

  res.json({
    status: 'ok',
    uptime,
    sessions: {
      total: sessions.length,
      active: sessions.filter(s => s.mobileSocketId || s.monitorSocketId).length,
    },
  });
});
```

---

## 15. ë™ê¸°í™” ì—”ì§„ ì•„í‚¤í…ì²˜

### 15.1 ì–‘ë°©í–¥ ì‹¤ì‹œê°„ ë™ê¸°í™” ê°œìš”

#### A. ë™ê¸°í™” ë°©í–¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ                 â”‚
â”‚  (ì›Œì¹˜ ë””ë ‰í„°ë¦¬: .vooster/tasks)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ chokidar (íŒŒì¼ ì›Œì²˜)
           â”‚ add/change/unlink ê°ì§€
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SyncEngine                      â”‚
â”‚  - íŒŒì¼ ë³€ê²½ ì²˜ë¦¬                      â”‚
â”‚  - ì¶©ëŒ í•´ê²°                           â”‚
â”‚  - API í˜¸ì¶œ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (ë¡œì»¬ â†’ ì›ê²©)
           â”‚ create/update/delete
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Vooster API (ì›ê²©)                 â”‚
â”‚  /tasks (CRUD ì—”ë“œí¬ì¸íŠ¸)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ polling (ë§¤ 30ì´ˆ)
           â”‚ listUpdatedSince()
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì›ê²© ë³€ê²½ ê°ì§€ & ë¡œì»¬ ë™ê¸°í™”          â”‚
â”‚   (ì›ê²© â†’ ë¡œì»¬)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### B. ë™ê¸°í™” íë¦„

```typescript
// íŒŒì¼ ë³€ê²½ ê°ì§€ â†’ í ì¶”ê°€ â†’ ì²˜ë¦¬

// 1. íŒŒì¼ ë³€ê²½ ê°ì§€
this.watcher = chokidar.watch(watchDir, {
  ignoreInitial: true,
  awaitWriteFinish: {
    stabilityThreshold: 300,  // 300ms ë™ì•ˆ ë³€ê²½ ì—†ìœ¼ë©´ ì²˜ë¦¬
    pollInterval: 100,
  },
});

// 2. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
this.watcher.on('add', (filePath) =>
  this.enqueue('create', filePath)
);
this.watcher.on('change', (filePath) =>
  this.enqueue('update', filePath)
);
this.watcher.on('unlink', (filePath) =>
  this.enqueue('delete', filePath)
);

// 3. íì— ì¶”ê°€
private enqueue(kind: 'create' | 'update' | 'delete', filePath: string) {
  const event: FileChangeEvent = {
    kind,
    path: filePath,
    timestamp: new Date().toISOString(),
  };

  // p-queueë¥¼ ì‚¬ìš©í•œ ë™ì‹œì„± ì œì–´ (ê¸°ë³¸ 5ê°œ)
  this.queue.add(() => this.processLocalChange(event));
}

// 4. ì²˜ë¦¬ (ë¡œì»¬ â†’ ì›ê²©)
private async processLocalChange(event: FileChangeEvent) {
  // íŒŒì¼ íŒŒì‹±
  const task = await parseTaskFile(event.path);

  // ë§¤í•‘ ìŠ¤í† ì–´ì—ì„œ ê¸°ì¡´ ë§¤í•‘ ì¡°íšŒ
  const mapping = this.store.get(task.id);

  // ì›ê²© íƒœìŠ¤í¬ ì¡°íšŒ
  const remoteTask = mapping?.remoteId
    ? await this.api.getTask(mapping.remoteId)
    : await this.api.findByExternalId(task.id);

  if (!remoteTask) {
    // ìƒˆë¡œìš´ íƒœìŠ¤í¬ ìƒì„±
    return await this.createRemoteTask(task, event.path);
  }

  // ê¸°ì¡´ íƒœìŠ¤í¬ ì—…ë°ì´íŠ¸ (ì¶©ëŒ í•´ê²° í¬í•¨)
  return await this.updateRemoteTask(task, remoteTask, event.path);
}
```

### 15.2 SQLite ë§¤í•‘ ìŠ¤í† ì–´

#### A. ìŠ¤í‚¤ë§ˆ

```sql
CREATE TABLE IF NOT EXISTS mappings (
  -- ê¸°ë³¸ í‚¤
  localId TEXT PRIMARY KEY,          -- ë¡œì»¬ íŒŒì¼ ID (íŒŒì¼ëª…)
  filePath TEXT NOT NULL UNIQUE,     -- íŒŒì¼ ê²½ë¡œ
  remoteId TEXT,                     -- ì›ê²© íƒœìŠ¤í¬ ID

  -- ë²„ì „ ê´€ë¦¬
  etag TEXT,                         -- HTTP ETag (ë‚™ê´€ì  ì ê¸ˆ)
  remoteVersion INTEGER,             -- ì›ê²© ë²„ì „ ë²ˆí˜¸

  -- ì‹œê°„ ì¶”ì 
  lastSyncedAt TEXT NOT NULL,        -- ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„
  lastLocalUpdatedAt TEXT NOT NULL,  -- ë¡œì»¬ ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„
  lastRemoteUpdatedAt TEXT,          -- ì›ê²© ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„

  -- ë©”íƒ€ë°ì´í„°
  deletionPolicy TEXT NOT NULL DEFAULT 'archive',  -- archive|delete|ignore
  createdAt TEXT NOT NULL,           -- ë ˆì½”ë“œ ìƒì„± ì‹œê°„
  syncCount INTEGER NOT NULL DEFAULT 0,  -- ë™ê¸°í™” íšŸìˆ˜

  -- ì¸ë±ìŠ¤
  CREATE INDEX idx_remoteId ON mappings(remoteId);
  CREATE INDEX idx_filePath ON mappings(filePath);
  CREATE INDEX idx_lastSyncedAt ON mappings(lastSyncedAt);
);
```

#### B. ì£¼ìš” ì‘ì—…

```typescript
// 1. ë§¤í•‘ ì¡°íšŒ
get(localId: string): MappingRecord | null {
  const stmt = this.db.prepare('SELECT * FROM mappings WHERE localId = ?');
  return stmt.get(localId);
}

// 2. ë§¤í•‘ ì €ì¥
upsert(record: Partial<MappingRecord>) {
  const now = new Date().toISOString();
  const existing = this.get(record.localId);

  if (existing) {
    // UPDATE: ê¸°ì¡´ ë ˆì½”ë“œ ê°±ì‹ 
    const stmt = this.db.prepare(`
      UPDATE mappings
      SET filePath = ?, remoteId = ?, etag = ?,
          lastSyncedAt = ?, lastLocalUpdatedAt = ?,
          lastRemoteUpdatedAt = ?, syncCount = syncCount + 1
      WHERE localId = ?
    `);
    stmt.run(...params);
  } else {
    // INSERT: ìƒˆ ë ˆì½”ë“œ ìƒì„±
    const stmt = this.db.prepare(`
      INSERT INTO mappings (
        localId, filePath, remoteId, etag, lastSyncedAt,
        lastLocalUpdatedAt, lastRemoteUpdatedAt, createdAt, syncCount
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, 1)
    `);
    stmt.run(...params);
  }
}

// 3. ì‹œê°„ ê°±ì‹  (ë¡œì»¬ ë³€ê²½ ì‹œ)
touchLocal(
  localId: string,
  lastLocalUpdatedAt: string,
  lastRemoteUpdatedAt?: string,
  etag?: string
) {
  const stmt = this.db.prepare(`
    UPDATE mappings
    SET lastLocalUpdatedAt = ?, lastRemoteUpdatedAt = ?, etag = ?, lastSyncedAt = ?
    WHERE localId = ?
  `);
  stmt.run(lastLocalUpdatedAt, lastRemoteUpdatedAt, etag, now, localId);
}

// 4. í´ë§ ê¸°ì¤€ì  ì¡°íšŒ (ë§ˆì§€ë§‰ ë™ê¸°í™” ì´í›„ ë³€ê²½ ê°ì§€)
async getMaxRemoteUpdatedAt(): Promise<string | null> {
  const stmt = this.db.prepare(`
    SELECT MAX(lastRemoteUpdatedAt) as maxDate
    FROM mappings
    WHERE lastRemoteUpdatedAt IS NOT NULL
  `);
  const row = stmt.get();
  return row?.maxDate || null;
}
```

**WAL ëª¨ë“œ ìµœì í™”**:
```typescript
this.db.pragma('journal_mode = WAL');  // Write-Ahead Logging

// ì¥ì :
// - ì½ê¸°ì™€ ì“°ê¸°ê°€ ë™ì‹œì— ê°€ëŠ¥
// - ì¶©ëŒ ê°ì†Œ
// - ë” ë¹ ë¥¸ ì„±ëŠ¥
// - ë©€í‹° ìŠ¤ë ˆë“œ/í”„ë¡œì„¸ìŠ¤ ì•ˆì „
```

### 15.3 ì¶©ëŒ í•´ê²° ì „ëµ

#### A. íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ LWW (Last-Write-Wins)

```typescript
// ì¶©ëŒ ê°ì§€
const localTime = new Date(localTask.updatedAt).getTime();
const remoteTime = new Date(remoteTask.updatedAt).getTime();
const diff = localTime - remoteTime;

// í—ˆìš© ë“œë¦¬í”„íŠ¸ ë‚´ ë™ì‹œ ë³€ê²½: ë¡œì»¬ ìš°ì„ 
if (Math.abs(diff) <= config.clockDriftMs) {  // ê¸°ë³¸ 5ì´ˆ
  return 'local';  // ë¡œì»¬ ë³€ê²½ ìš°ì„  ì ìš©
}

// ëª…í™•í•œ ì‹œê°„ ì°¨ì´: ìµœì‹  ìš°ì„ 
return localTime > remoteTime ? 'local' : 'remote';
```

**íë¦„ë„**:
```
ë‘ ë²„ì „ ëª¨ë‘ ë³€ê²½ë¨?
â”œâ”€ Yes: íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ
â”‚  â”œâ”€ ì°¨ì´ < 5ì´ˆ: ë¡œì»¬ ìš°ì„ 
â”‚  â”œâ”€ ë¡œì»¬ì´ ìµœì‹ : ì›ê²© ì—…ë°ì´íŠ¸
â”‚  â””â”€ ì›ê²©ì´ ìµœì‹ : ë¡œì»¬ ë®ì–´ì“°ê¸°
â””â”€ No: í•´ë‹¹ ë²„ì „ ì ìš©
```

#### B. ë‚™ê´€ì  ì ê¸ˆ (ETag)

```typescript
// 1. ì›ê²© íƒœìŠ¤í¬ ì¡°íšŒ ì‹œ ETag ë°›ìŒ
const remoteTask = await this.api.getTask(taskId);
// { id, title, ..., etag: "abc123" }

// 2. ì—…ë°ì´íŠ¸ ì‹œ ETag í¬í•¨
const updated = await this.api.updateTask(
  taskId,
  newPayload,
  { ifMatch: remoteTask.etag }  // ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸
);

// ì„œë²„ê°€ ETag ê²€ì¦:
// - ì¼ì¹˜: ì—…ë°ì´íŠ¸ ì„±ê³µ, ìƒˆ ETag ë°˜í™˜
// - ë¶ˆì¼ì¹˜: 409 Conflict ë°˜í™˜
// â†’ ë‹¤ì‹œ ì¡°íšŒ í›„ ì¬ì‹œë„
```

#### C. ì¶©ëŒ ë¡œê·¸

```typescript
const conflictResolver = new ConflictResolver(logger);

const resolution = conflictResolver.resolve({
  localTask: localTask,
  remoteTask: remoteTask,
  clockDriftMs: 5000,
});

// ê²°ê³¼
{
  winner: 'local',           // ìŠ¹ë¦¬ì
  reason: 'latest_timestamp', // ì´ìœ 
  localTimestamp: 1700000000,
  remoteTimestamp: 1699999990,
  driftMs: 10,               // ì‹œê°„ ì°¨ì´
}

// ë¡œê·¸ ê¸°ë¡
conflictResolver.logConflict(context, resolution);
// [WARN] ì¶©ëŒ í•´ê²°ë¨: localId=task-001, winner=local, driftMs=10
```

### 15.4 íŒŒì¼ ê°ì‹œ ë° í´ë§

#### A. Chokidar ì„¤ì •

```typescript
this.watcher = chokidar.watch(watchDir, {
  ignoreInitial: true,                      // ì‹œì‘ ì‹œ ê¸°ì¡´ íŒŒì¼ ë¬´ì‹œ
  awaitWriteFinish: {
    stabilityThreshold: 300,                // 300ms ë™ì•ˆ ë³€ê²½ ì—†ìœ¼ë©´ ì²˜ë¦¬
    pollInterval: 100,                      // 100msë§ˆë‹¤ í™•ì¸
  },
  ignored: /(^|[\/\\])\../,                 // .ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” íŒŒì¼ ë¬´ì‹œ
});

// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
this.watcher.on('add', (filePath) => {
  this.enqueue('create', filePath);
});

this.watcher.on('change', (filePath) => {
  this.enqueue('update', filePath);
});

this.watcher.on('unlink', (filePath) => {
  this.enqueue('delete', filePath);
});

// ì—ëŸ¬ ì²˜ë¦¬
this.watcher.on('error', (error) => {
  this.logger.error({ error }, 'íŒŒì¼ ì›Œì²˜ ì—ëŸ¬');
});
```

**ì„¤ì • ì£¼ì˜ì‚¬í•­**:
- `stabilityThreshold`: ë„ˆë¬´ ì‘ìœ¼ë©´ ë¯¸ì™„ì„± íŒŒì¼ ì²˜ë¦¬, ë„ˆë¬´ í¬ë©´ ì§€ì—°
- `ignored`: ë¡œê·¸ íŒŒì¼, ì„ì‹œ íŒŒì¼ ì œì™¸ ê¶Œì¥

#### B. í´ë§ ë£¨í”„ (ì •ê¸°ì  ë™ê¸°í™”)

```typescript
private startPolling(): void {
  this.pollInterval = setInterval(
    async () => {
      try {
        // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œì  ì´í›„ ë³€ê²½ ì¡°íšŒ
        const since = await this.store.getMaxRemoteUpdatedAt();
        const changed = await this.api.listUpdatedSince(since);

        if (changed.length === 0) {
          return;  // ë³€ê²½ ì—†ìŒ
        }

        // ì›ê²© ë³€ê²½ì„ ë¡œì»¬ íŒŒì¼ë¡œ ì ìš©
        for (const remoteTask of changed) {
          try {
            const mapping = this.store.getByRemoteId(remoteTask.id);
            const filePath = mapping?.filePath || path.join(
              this.config.watchDir,
              pathFromTitle(remoteTask.title)
            );

            // íŒŒì¼ ì“°ê¸°
            await writeTaskFile(filePath, fromRemotePayload(remoteTask));

            // ë§¤í•‘ ì—…ë°ì´íŠ¸
            this.store.linkOrUpdate(remoteTask, filePath);
          } catch (error) {
            this.logger.error({ remoteId: remoteTask.id, error }, 'ë™ê¸°í™” ì‹¤íŒ¨');
          }
        }
      } catch (error) {
        this.logger.error({ error }, 'í´ë§ ë™ê¸°í™” ì‹¤íŒ¨');
      }
    },
    this.config.pollIntervalMs  // ê¸°ë³¸ 30ì´ˆ
  );
}
```

**í´ë§ ì„¤ê³„ ê³ ë ¤ì‚¬í•­**:
- **ê°„ê²© ì„¤ì •**: 30-60ì´ˆ ê¶Œì¥ (API ë¶€í•˜ vs ì§€ì—° ê· í˜•)
- **ë™ì‹œì„±**: íŒŒì¼ ì›Œì²˜ì™€ í´ë§ì´ ë™ì‹œì— ì‹¤í–‰ ê°€ëŠ¥
- **ìˆœì„œ ë³´ì¥**: íŒŒì¼ ì›Œì²˜ê°€ ìš°ì„ , í´ë§ì€ ë°±ì—…
- **API í˜¸ì¶œ**: ë³€ê²½ ì—†ì„ ë•Œë„ í˜¸ì¶œ (ê°€ë³ê²Œ ìµœì í™”)

### 15.5 íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë° Best Practices

#### A. í”í•œ ë¬¸ì œì™€ í•´ê²°

**ë¬¸ì œ 1: íŒŒì¼ì´ ë™ê¸°í™”ë˜ì§€ ì•ŠìŒ**

```typescript
// ì²´í¬ë¦¬ìŠ¤íŠ¸:
1. íŒŒì¼ í¬ë§· í™•ì¸ (.json ë˜ëŠ” .md)
   â””â”€ parseTaskFileì´ ì§€ì›í•˜ëŠ” í˜•ì‹ì¸ê°€?

2. ê°ì‹œ ë””ë ‰í„°ë¦¬ í™•ì¸
   â””â”€ SYNC_WATCH_DIRì´ ì˜¬ë°”ë¥¸ ê²½ë¡œì¸ê°€?

3. ìŠ¤í‚¤ë§ˆ ê²€ì¦
   â””â”€ í•„ìˆ˜ í•„ë“œê°€ ìˆëŠ”ê°€? (id, title, updatedAt)

4. ë¡œê·¸ í™•ì¸
   â””â”€ LOG_LEVEL=debugë¡œ ìƒì„¸ ë¡œê·¸ í™•ì¸

// ë””ë²„ê¹… ì˜ˆì‹œ
console.log('íŒŒì¼ ê°ì‹œ ì¤‘:', {
  watchDir: resolveAbsolutePath(config.watchDir),
  watcherActive: !!this.watcher,
  queueSize: this.queue.size,
  pendingOperations: this.queue.pending,
});
```

**ë¬¸ì œ 2: ì¶©ëŒì´ ê³„ì† ë°œìƒ**

```typescript
// ì›ì¸:
1. ì‹œìŠ¤í…œ ì‹œê°„ ë™ê¸°í™” ë¬¸ì œ
   â””â”€ NTP ì„¤ì • í™•ì¸
   â””â”€ `date` ëª…ë ¹ìœ¼ë¡œ ì‹œê°„ í™•ì¸

2. clockDriftMs ê°’ì´ ë„ˆë¬´ ì‘ìŒ
   â””â”€ SYNC_CLOCK_DRIFT_MS=5000 (ê¸°ë³¸)
   â””â”€ SYNC_CLOCK_DRIFT_MS=10000ìœ¼ë¡œ ì¦ê°€

3. ë¡œì»¬ì™€ ì›ê²©ì´ ê±°ì˜ ë™ì‹œì— ë³€ê²½ë¨
   â””â”€ ì •ìƒ ë™ì‘ (LWWë¡œ ìë™ í•´ê²°)
```

#### B. ì„±ëŠ¥ ìµœì í™”

```typescript
// 1. ë™ì‹œì„± ì œì–´
this.queue = new PQueue({
  concurrency: config.concurrency,  // ê¸°ë³¸ 5
});
// ë„ˆë¬´ ë†’ìœ¼ë©´ API ë¶€í•˜, ë„ˆë¬´ ë‚®ìœ¼ë©´ ì²˜ë¦¬ ì§€ì—°

// 2. ë°°ì¹˜ ì²˜ë¦¬
const batch = changed.slice(0, 10);  // 10ê°œì”© ì²˜ë¦¬
await Promise.all(batch.map(task => this.sync(task)));

// 3. ìºì‹±
const mapping = this.mappingCache.get(localId) || this.store.get(localId);

// 4. í´ë§ ê°„ê²© ë™ì  ì¡°ì •
if (changed.length > 50) {
  // ë³€ê²½ ë§ìŒ: í´ë§ ê°„ê²© ë‹¨ì¶•
  pollIntervalMs = 15000;
} else if (changed.length === 0) {
  // ë³€ê²½ ì—†ìŒ: í´ë§ ê°„ê²© ì—°ì¥
  pollIntervalMs = 60000;
}
```

#### C. ëª¨ë‹ˆí„°ë§

```typescript
// í—¬ìŠ¤ ì²´í¬
const health = engine.getHealth();
console.log('ë™ê¸°í™” ì—”ì§„ ìƒíƒœ:', {
  healthy: health.healthy,
  lastSyncAt: health.lastSyncAt,
  pendingOperations: health.pendingOperations,
  stats: health.stats,
});

// ê²°ê³¼
{
  healthy: true,
  lastSyncAt: "2025-01-22T10:30:00.000Z",
  lastErrorAt: null,
  pendingOperations: 0,
  stats: {
    created: 10,
    updated: 5,
    deleted: 2,
    conflicts: 1,
    errors: 0,
    skipped: 0,
  }
}

// ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­
class SyncMetrics {
  recordSync(operation: SyncOperation, durationMs: number) {
    // Prometheusì— í‘¸ì‹œ
    syncDuration.observe(durationMs);
    syncCount.inc({ operation });
  }
}
```

---

**ì‘ì„±ì**: ì‹ ìš°ì§„
**í”„ë¡œì íŠ¸**: Vooster
**ë²„ì „**: 1.0
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-22
